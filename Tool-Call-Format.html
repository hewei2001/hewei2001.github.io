<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/logo.jpg"><link rel="icon" href="/img/logo.jpg"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"><meta name="theme-color" content="#01213a"><meta name="author" content="Wei He"><meta name="keywords" content="Computer Science and Technology, Machine Learning, Deep Learning, Computer Vision, Natural Language Processing"><meta name="description" content="与趋于一致的推理格式不同，各家开源模型（Qwen3&#x2F;GLM-4.5&#x2F;DS-V3.1 等）的工具调用格式却显现出了分化的趋势。而正确使用工具调用格式是入门 Agent SFT 或 RL 训练的第一步，因此本文整理了一些近期开源模型的工具调用格式。"><meta property="og:type" content="article"><meta property="og:title" content="从近期开源模型看工具调用格式的分化"><meta property="og:url" content="https://hwcoder.top/Tool-Call-Format"><meta property="og:site_name" content="Hwcoder - Life Oriented Programming"><meta property="og:description" content="与趋于一致的推理格式不同，各家开源模型（Qwen3&#x2F;GLM-4.5&#x2F;DS-V3.1 等）的工具调用格式却显现出了分化的趋势。而正确使用工具调用格式是入门 Agent SFT 或 RL 训练的第一步，因此本文整理了一些近期开源模型的工具调用格式。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://hwcoder.top/img/home/LLM.jpg"><meta property="article:published_time" content="2025-08-28T07:28:32.000Z"><meta property="article:modified_time" content="2025-08-31T07:49:14.907Z"><meta property="article:author" content="Wei He"><meta property="article:tag" content="LLMs"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://hwcoder.top/img/home/LLM.jpg"><title>从近期开源模型看工具调用格式的分化 | Hwcoder - Life Oriented Programming</title><link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><link rel="stylesheet" href="/css/mac.css"><script id="fluid-configs">var Fluid=window.Fluid||{};Fluid.ctx=Object.assign({},Fluid.ctx);var dntVal,CONFIG={hostname:"hwcoder.top",root:"/",version:"1.9.5",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h2, h3",placement:"left",visible:"always",icon:"§"},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4",collapseDepth:3},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!0,follow_dnt:!0,baidu:null,google:{measurement_id:null},tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:"XGNf4GEnaFLiUijMUvz8HSBF-gzGzoHsz",app_key:"JPeVLcug6EcWdBTpGrDJSdKi",server_url:"https://xgnf4gen.lc-cn-n1-shared.com",path:"window.location.pathname",ignore_local:!0}},search_path:"/local-search.xml",include_content_in_search:!0};CONFIG.web_analytics.follow_dnt&&(dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on")))</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><script async>Fluid.ctx.dnt||Fluid.utils.createScript("https://www.googletagmanager.com/gtag/js?id=",function(){function a(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],a("js",new Date),a("config","")})</script><meta name="generator" content="Hexo 5.4.2"></head><body><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>Hwcoder</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> <span>首页</span></a></li><li class="nav-item"><a class="nav-link" href="/archives/"><i class="iconfont icon-archive-fill"></i> <span>归档</span></a></li><li class="nav-item"><a class="nav-link" href="/categories/"><i class="iconfont icon-category-fill"></i> <span>分类</span></a></li><li class="nav-item"><a class="nav-link" href="/tags/"><i class="iconfont icon-tags-fill"></i> <span>标签</span></a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> <span>关于</span></a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search"><i class="iconfont icon-search"></i></a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle"><i class="iconfont icon-dark" id="color-toggle-icon"></i></a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(/img/bg/other.jpg) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle" data-typed-text="从近期开源模型看工具调用格式的分化"></span></div><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2025-08-28 15:28" pubdate>2025年8月28日 下午</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 27k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 152 分钟 </span><span id="leancloud-page-views-container" class="post-meta" style="display:none"><i class="iconfont icon-eye" aria-hidden="true"></i> <span id="leancloud-page-views"></span> 次</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar category-bar" style="margin-right:-1rem"><div class="category-list"><div class="category row nomargin-x"><a class="category-item list-group-item category-item-action col-10 col-md-11 col-xm-11" title="论文阅读" id="heading-7545c85b0df88485ddabffad9bb45965" role="tab" data-toggle="collapse" href="#collapse-7545c85b0df88485ddabffad9bb45965" aria-expanded="true">论文阅读 <span class="list-group-count">(6)</span> <i class="iconfont icon-arrowright"></i></a><div class="category-collapse collapse show" id="collapse-7545c85b0df88485ddabffad9bb45965" role="tabpanel" aria-labelledby="heading-7545c85b0df88485ddabffad9bb45965"><div class="category-post-list"></div><div class="category-sub row nomargin-x"><a class="category-subitem list-group-item category-item-action col-10 col-md-11 col-xm-11" title="前沿热点" id="heading-f544ecc494bb390491f578dd08b7a8b2" role="tab" data-toggle="collapse" href="#collapse-f544ecc494bb390491f578dd08b7a8b2" aria-expanded="true">前沿热点 <span class="list-group-count">(3)</span> <i class="iconfont icon-arrowright"></i></a><div class="category-collapse collapse show" id="collapse-f544ecc494bb390491f578dd08b7a8b2" role="tabpanel" aria-labelledby="heading-f544ecc494bb390491f578dd08b7a8b2"><div class="category-post-list"><a href="/OpenAI-o1-Series" title="OpenAI o1 系列模型背后的技术猜测" class="list-group-item list-group-item-action"><span class="category-post">OpenAI o1 系列模型背后的技术猜测</span> </a><a href="/OpenAI-o3-Series" title="OpenAI o3 与 Monte-Carlo 思想" class="list-group-item list-group-item-action"><span class="category-post">OpenAI o3 与 Monte-Carlo 思想</span> </a><a href="/Tool-Call-Format" title="从近期开源模型看工具调用格式的分化" class="list-group-item list-group-item-action active"><span class="category-post">从近期开源模型看工具调用格式的分化</span></a></div></div></div><div class="category-sub row nomargin-x"><a class="category-subitem collapsed list-group-item category-item-action col-10 col-md-11 col-xm-11" title="推荐系统" id="heading-b89d9a904b3b7c6f47d8363671ec6140" role="tab" data-toggle="collapse" href="#collapse-b89d9a904b3b7c6f47d8363671ec6140" aria-expanded="false">推荐系统 <span class="list-group-count">(2)</span> <i class="iconfont icon-arrowright"></i></a><div class="category-collapse collapse" id="collapse-b89d9a904b3b7c6f47d8363671ec6140" role="tabpanel" aria-labelledby="heading-b89d9a904b3b7c6f47d8363671ec6140"><div class="category-post-list"><a href="/Uplift-Paper-Collection" title="Uplift Recommendation 论文汇总" class="list-group-item list-group-item-action"><span class="category-post">Uplift Recommendation 论文汇总</span> </a><a href="/Uplift-Modeling" title="浅谈 Uplift Modeling" class="list-group-item list-group-item-action"><span class="category-post">浅谈 Uplift Modeling</span></a></div></div></div><div class="category-sub row nomargin-x"><a class="category-subitem collapsed list-group-item category-item-action col-10 col-md-11 col-xm-11" title="自然语言处理" id="heading-f48c43f5fd14bfd8a5057a0131e7aa20" role="tab" data-toggle="collapse" href="#collapse-f48c43f5fd14bfd8a5057a0131e7aa20" aria-expanded="false">自然语言处理 <span class="list-group-count">(1)</span> <i class="iconfont icon-arrowright"></i></a><div class="category-collapse collapse" id="collapse-f48c43f5fd14bfd8a5057a0131e7aa20" role="tabpanel" aria-labelledby="heading-f48c43f5fd14bfd8a5057a0131e7aa20"><div class="category-post-list"><a href="/FudanNLP-LI-Bib" title="复旦 NLP-LI 课题组近期论文索引" class="list-group-item list-group-item-action"><span class="category-post">复旦 NLP-LI 课题组近期论文索引</span></a></div></div></div></div></div></div></aside></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 id="seo-header">从近期开源模型看工具调用格式的分化</h1><p class="note note-info">本文最后更新于：2025年8月31日 下午</p><div class="markdown-body"><p>最近，国内外开源大模型集体把目光投向「Agent 能力」。从 SWE-Bench 到 Terminal-Bench，从 Tau-Bench 到 Tau2-Bench，再到 BrowseComp、GAIA、HLE，榜单刷分卷出了新高度，也划出了三条主赛道：Agentic Coding、Agentic Tool Using 与 Agentic Search。</p><p>与趋于一致的推理格式（使用 <code>&lt;think&gt;...&lt;/think&gt;</code> 包裹 reasoning content）不同，各家开源模型的工具调用格式却显现出了分化的趋势。而正确使用工具调用格式是入门 Agent SFT 或 RL 训练的第一步，因此本文整理了一些近期开源模型的工具调用格式，包括：</p><ul><li>以 Qwen3 为代表的单字典形式</li><li>以 DeepSeek-V3.1、Kimi-K2、GPT-OSS 为代表的函数名+字典形式</li><li>以 GLM-4.5、Seed-OSS-36B 为代表的参数格式形式</li></ul><h2 id="基本知识">基本知识</h2><h3 id="最简单的工具调用">最简单的工具调用</h3><p>这里以 <a target="_blank" rel="noopener" href="https://api-docs.deepseek.com/zh-cn/guides/function_calling">DeepSeek 官方 API Docs</a> 中的「获取用户当前位置的天气信息」为例，展示了使用 Tool Calling 的完整 Python 代码。之后本文中的例子也会再次用到 <code>get_weather</code> 这个工具。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> openai <span class="hljs-keyword">import</span> OpenAI<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">send_messages</span>(<span class="hljs-params">messages, tools</span>):</span><br>    response = client.chat.completions.create(<br>        model=<span class="hljs-string">&quot;deepseek-chat&quot;</span>,<br>        messages=messages,<br>        tools=tools<br>    )<br>    <span class="hljs-keyword">return</span> response.choices[<span class="hljs-number">0</span>].message<br><br>client = OpenAI(<br>    api_key=<span class="hljs-string">&quot;&lt;your api key&gt;&quot;</span>,<br>    base_url=<span class="hljs-string">&quot;https://api.deepseek.com&quot;</span>,<br>)<br><br>tools = [<br>    &#123;<br>        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;function&quot;</span>,<br>        <span class="hljs-string">&quot;function&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;get_weather&quot;</span>,<br>            <span class="hljs-string">&quot;description&quot;</span>: <span class="hljs-string">&quot;Get current weather information for a location&quot;</span>,<br>            <span class="hljs-string">&quot;parameters&quot;</span>: &#123;<br>                <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;object&quot;</span>,<br>                <span class="hljs-string">&quot;properties&quot;</span>: &#123;<br>                    <span class="hljs-string">&quot;location&quot;</span>: &#123;<br>                        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span>,<br>                        <span class="hljs-string">&quot;description&quot;</span>: <span class="hljs-string">&quot;The city and state, e.g. San Francisco, CA&quot;</span>,<br>                    &#125;<br>                &#125;,<br>                <span class="hljs-string">&quot;required&quot;</span>: [<span class="hljs-string">&quot;location&quot;</span>]<br>            &#125;,<br>        &#125;<br>    &#125;,<br>]<br><br>messages = [&#123;<span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;user&quot;</span>, <span class="hljs-string">&quot;content&quot;</span>: <span class="hljs-string">&quot;How&#x27;s the weather in Hangzhou?&quot;</span>&#125;]<br>message = send_messages(messages)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;User&gt;\t <span class="hljs-subst">&#123;messages[<span class="hljs-number">0</span>][<span class="hljs-string">&#x27;content&#x27;</span>]&#125;</span>&quot;</span>)<br><br>tool = message.tool_calls[<span class="hljs-number">0</span>]<br>messages.append(message)<br><br>messages.append(&#123;<span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;tool&quot;</span>, <span class="hljs-string">&quot;tool_call_id&quot;</span>: tool.<span class="hljs-built_in">id</span>, <span class="hljs-string">&quot;content&quot;</span>: <span class="hljs-string">&quot;24℃&quot;</span>&#125;)<br>message = send_messages(messages)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Model&gt;\t <span class="hljs-subst">&#123;message.content&#125;</span>&quot;</span>)<br></code></pre></td></tr></table></figure><p>这个例子的执行流程如下：</p><ol type="1"><li>用户：询问现在的天气。</li><li>模型：返回 function <code>get_weather(&#123;location: 'Hangzhou'&#125;)</code></li><li>工具：调用 function <code>get_weather(&#123;location: 'Hangzhou'&#125;)</code>，并将工具返回结果传给模型。</li><li>模型：返回自然语言，"The current temperature in Hangzhou is 24°C."</li></ol><blockquote><p>注 1：上述代码中 <code>get_weather</code> 函数功能需由用户提供，模型本身不执行具体函数。</p><p>注 2：上述代码中工具返回结果带有 <code>tool_call_id</code> 参数，这是为了防止多个工具并行调用时顺序混淆，下文中将略去。</p></blockquote><h3 id="agent-loop">Agent Loop</h3><p>显然，上述的代码只是硬编码了一个固定的、单轮的工具调用流程，如果我们想实现一个复杂的、多轮的工具调用流程，则需要引入「<strong>Agent Loop</strong>」这个概念 —— 说人话就是，<strong>允许 Agent 多次调用工具直到任务结束跳出循环</strong>。</p><p>其核心操作在于解析出模型回复中的 tool_call 部分，如果有 tool_call，则表示模型认为任务尚未结束，需要继续循环；如果没有 tool_call，则表示模型认为任务已经结束（此时模型的回答一般是对之前工具调用结果的总结）。</p><p>用伪代码表示这个流程：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs Python">messages = [&#123;<span class="hljs-string">&#x27;role&#x27;</span>:<span class="hljs-string">&#x27;user&#x27;</span>, <span class="hljs-string">&#x27;content&#x27;</span>: query&#125;]<br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    response = send_messages(messages, tools)<br>    messages.append(&#123;<span class="hljs-string">&#x27;role&#x27;</span>:<span class="hljs-string">&#x27;assistant&#x27;</span>, <span class="hljs-string">&#x27;content&#x27;</span>: response&#125;)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> response.tool_calls:<br>        <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">for</span> tool_call <span class="hljs-keyword">in</span> tool_calls:<br>        tool_result = call_tool(tool_call)<br>        messages.append(&#123;<span class="hljs-string">&#x27;role&#x27;</span>:<span class="hljs-string">&#x27;tool&#x27;</span>, <span class="hljs-string">&#x27;content&#x27;</span>: tool_result&#125;)<br><span class="hljs-keyword">return</span> messages[-<span class="hljs-number">1</span>][<span class="hljs-string">&#x27;content&#x27;</span>]<br></code></pre></td></tr></table></figure><p>完整的实现可以参考 <a target="_blank" rel="noopener" href="https://github.com/MoonshotAI/Kimi-K2?tab=readme-ov-file#tool-calling">Kimi-K2 官方仓库</a> 的示例，这里我将其改成了 Search Agent 的常用工具集，并附上了一个需要多跳搜索才能回答的问题帮助理解：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-comment"># Map tool names to their implementations</span><br>tool_map = &#123;<br>    <span class="hljs-string">&quot;search&quot;</span>: search,<br>    <span class="hljs-string">&quot;browse&quot;</span>: browse,<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">tool_call_with_client</span>(<span class="hljs-params">client: OpenAI, model_name: <span class="hljs-built_in">str</span></span>):</span><br>    messages = [<br>        &#123;<span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;system&quot;</span>, <span class="hljs-string">&quot;content&quot;</span>: <span class="hljs-string">&quot;You are a helpful assistant that can use tools to get information for the user.&quot;</span>&#125;,<br>        &#123;<span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;user&quot;</span>, <span class="hljs-string">&quot;content&quot;</span>: <span class="hljs-string">&quot;What is the birth year of the director of the movie &#x27;Inception&#x27;?&quot;</span>&#125;<br>    ]<br>    finish_reason = <span class="hljs-literal">None</span><br>    <span class="hljs-keyword">while</span> finish_reason <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">or</span> finish_reason == <span class="hljs-string">&quot;tool_calls&quot;</span>:<br>        completion = client.chat.completions.create(<br>            model=model_name,<br>            messages=messages,<br>            temperature=<span class="hljs-number">0.6</span>,<br>            tools=tools,<br>            tool_choice=<span class="hljs-string">&quot;auto&quot;</span><br>        )<br>        choice = completion.choices[<span class="hljs-number">0</span>]<br>        finish_reason = choice.finish_reason<br>        <span class="hljs-keyword">if</span> finish_reason == <span class="hljs-string">&quot;tool_calls&quot;</span>:<br>            messages.append(choice.message)<br>            <span class="hljs-keyword">for</span> tool_call <span class="hljs-keyword">in</span> choice.message.tool_calls:<br>                tool_call_name = tool_call.function.name<br>                tool_call_arguments = json.loads(tool_call.function.arguments)<br>                tool_function = tool_map[tool_call_name]<br>                tool_result = tool_function(**tool_call_arguments)<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;tool_result:&quot;</span>, tool_result)<br><br>                messages.append(&#123;<br>                    <span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;tool&quot;</span>,<br>                    <span class="hljs-string">&quot;tool_call_id&quot;</span>: tool_call.<span class="hljs-built_in">id</span>,<br>                    <span class="hljs-string">&quot;name&quot;</span>: tool_call_name,<br>                    <span class="hljs-string">&quot;content&quot;</span>: json.dumps(tool_result)<br>                &#125;)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;-&quot;</span> * <span class="hljs-number">100</span>)<br>    <span class="hljs-built_in">print</span>(choice.message.content)<br></code></pre></td></tr></table></figure><h3 id="messages-与-chat-template">Messages 与 Chat Template</h3><p>在即将进入正题之前，还有最后一个概念需要厘清。</p><p>我们平常在代码中所见的 User-Assistant 消息列表，并不能直接喂给模型。语言模型只认 token_id 序列，中间还要走两步：</p><ol type="1"><li>apply_chat_template：把消息列表<strong>按模型规定的模板拼成一段纯文本字符串</strong>；</li><li>tokenize：把这段文本切成 token 并转成 id。</li></ol><p>对话模板藏在各开源仓库的 tokenizer_config.json 中，里面的 <code>chat_template</code> 字段精确描述了「这一段对话该怎么拼」，本文的分析也都基于各个开源模型仓库中的模板推断而来。感兴趣的朋友可以在 Huggingface 提供的 <a target="_blank" rel="noopener" href="https://huggingface.co/spaces/huggingfacejs/chat-template-playground">Chat Template Playground</a> 进行实验。</p><p>下面我构造了一个多轮对话的消息列表示例，包含 System-User-Assistant-Tool-Assistant-User-Assistant-Tool 的交互过程（包括<strong>思考过程、并行工具调用</strong>等细节，可以手动删减来理解各种情况），直接复制到 Playground 右上角的 JSON Input 中即可生成纯文本字符串：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><code class="hljs YAML">&#123;<br>  <span class="hljs-attr">messages:</span> [<br>    &#123;<br>      <span class="hljs-attr">role:</span> <span class="hljs-string">&#x27;system&#x27;</span>,<br>      <span class="hljs-attr">content:</span> <span class="hljs-string">&#x27;You are a helpful assistant that can use tools to get information for the user.&#x27;</span>,<br>    &#125;,<br>    &#123;<br>      <span class="hljs-attr">role:</span> <span class="hljs-string">&#x27;user&#x27;</span>,<br>      <span class="hljs-attr">content:</span> <span class="hljs-string">&quot;What&#x27;s the weather like in New York?&quot;</span>,<br>    &#125;,<br>    &#123;<br>      <span class="hljs-attr">role:</span> <span class="hljs-string">&#x27;assistant&#x27;</span>,<br>      <span class="hljs-attr">content:</span> <span class="hljs-string">&quot;&lt;think&gt;\nThe user is asking about the weather in New York. I should use the weather tool to get this information.\n&lt;/think&gt;\nI&#x27;ll check the current weather in New York for you.&quot;</span>,<br>      <span class="hljs-attr">tool_calls:</span> [<br>        &#123;<br>          <span class="hljs-attr">function:</span> &#123;<br>            <span class="hljs-attr">name:</span> <span class="hljs-string">&#x27;get_weather&#x27;</span>,<br>            <span class="hljs-attr">arguments:</span> &#123;<br>              <span class="hljs-attr">location:</span> <span class="hljs-string">&#x27;New York&#x27;</span>,<br>            &#125;,<br>          &#125;,<br>        &#125;,<br>      ],<br>    &#125;,<br>    &#123;<br>      <span class="hljs-attr">role:</span> <span class="hljs-string">&#x27;tool&#x27;</span>,<br>      <span class="hljs-attr">content:</span> <span class="hljs-string">&#x27;&#123;&quot;temperature&quot;: 22, &quot;condition&quot;: &quot;Sunny&quot;, &quot;humidity&quot;: 45, &quot;wind_speed&quot;: 10&#125;&#x27;</span>,<br>    &#125;,<br>    &#123;<br>      <span class="hljs-attr">role:</span> <span class="hljs-string">&#x27;assistant&#x27;</span>,<br>      <span class="hljs-attr">content:</span> <span class="hljs-string">&quot;The weather in New York is currently sunny with a temperature of 22°C. The humidity is at 45% with a wind speed of 10 km/h. It&#x27;s a great day to be outside!&quot;</span>,<br>      <span class="hljs-attr">tool_calls:</span> <span class="hljs-literal">null</span>,<br>    &#125;,<br>    &#123;<br>      <span class="hljs-attr">role:</span> <span class="hljs-string">&#x27;user&#x27;</span>,<br>      <span class="hljs-attr">content:</span> <span class="hljs-string">&#x27;Thanks! What about Boston and Paris?&#x27;</span>,<br>    &#125;,<br>    &#123;<br>      <span class="hljs-attr">role:</span> <span class="hljs-string">&#x27;assistant&#x27;</span>,<br>      <span class="hljs-attr">content:</span> <span class="hljs-string">&quot;&lt;think&gt;\nThe user is now asking about the weather in two different cities: Boston and Paris. I need to call the weather tool twice - once for Boston and once for Paris.\n&lt;/think&gt;\nI&#x27;ll check the weather in both Boston and Paris for you.&quot;</span>,<br>      <span class="hljs-attr">tool_calls:</span> [<br>        &#123;<br>          <span class="hljs-attr">function:</span> &#123;<br>            <span class="hljs-attr">name:</span> <span class="hljs-string">&#x27;get_weather&#x27;</span>,<br>            <span class="hljs-attr">arguments:</span> &#123;<br>              <span class="hljs-attr">location:</span> <span class="hljs-string">&#x27;Boston&#x27;</span>,<br>            &#125;,<br>          &#125;,<br>        &#125;,<br>        &#123;<br>          <span class="hljs-attr">function:</span> &#123;<br>            <span class="hljs-attr">name:</span> <span class="hljs-string">&#x27;get_weather&#x27;</span>,<br>            <span class="hljs-attr">arguments:</span> &#123;<br>              <span class="hljs-attr">location:</span> <span class="hljs-string">&#x27;Paris&#x27;</span>,<br>            &#125;,<br>          &#125;,<br>        &#125;,<br>      ]<br>    &#125;,<br>    &#123;<br>      <span class="hljs-attr">role:</span> <span class="hljs-string">&#x27;tool&#x27;</span>,<br>      <span class="hljs-attr">content:</span> <span class="hljs-string">&#x27;&#123;&quot;temperature&quot;: 15, &quot;condition&quot;: &quot;Cloudy&quot;, &quot;humidity&quot;: 70, &quot;wind_speed&quot;: 12&#125;&#x27;</span>,<br>    &#125;,<br>    &#123;<br>      <span class="hljs-attr">role:</span> <span class="hljs-string">&#x27;tool&#x27;</span>,<br>      <span class="hljs-attr">content:</span> <span class="hljs-string">&#x27;&#123;&quot;temperature&quot;: 19, &quot;condition&quot;: &quot;Light Rain&quot;, &quot;humidity&quot;: 80, &quot;wind_speed&quot;: 8&#125;&#x27;</span>,<br>    &#125;,<br>  ],<br>  <span class="hljs-attr">tools:</span> [<br>    &#123;<br>      <span class="hljs-attr">name:</span> <span class="hljs-string">&#x27;get_weather&#x27;</span>,<br>      <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;Get current weather information for a location&#x27;</span>,<br>      <span class="hljs-attr">parameters:</span> &#123;<br>        <span class="hljs-attr">type:</span> <span class="hljs-string">&#x27;object&#x27;</span>,<br>        <span class="hljs-attr">properties:</span> &#123;<br>          <span class="hljs-attr">location:</span> &#123;<br>            <span class="hljs-attr">type:</span> <span class="hljs-string">&#x27;string&#x27;</span>,<br>            <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;The city and state, e.g. San Francisco, CA&#x27;</span>,<br>          &#125;,<br>        &#125;,<br>        <span class="hljs-attr">required:</span> [<br>          <span class="hljs-string">&#x27;location&#x27;</span>,<br>        ],<br>      &#125;,<br>    &#125;,<br>  ],<br>  <span class="hljs-attr">add_generation_prompt:</span> <span class="hljs-literal">true</span>,<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="以-qwen3-为代表的单字典形式">以 Qwen3 为代表的单字典形式</h2><p>Qwen3 系列模型对话模板的特点：</p><ol type="1"><li>包含三种角色：system、user、assistant，其中<strong>工具返回结果以 user 角色拼接</strong></li><li>每个角色消息开始于 <code>&lt;|im_start|&gt;</code>，结束于 <code>&lt;|im_end|&gt;</code></li><li>工具描述拼接在 system prompt 之后作为一部分，使用 <code>&lt;tools&gt;&lt;/tools&gt;</code> XML tags 包裹</li><li>工具调用格式为 <code>&lt;tool_call&gt;&#123;"name": &lt;function-name&gt;, "arguments": &lt;args-json-object&gt;&#125;&lt;/tool_call&gt;</code>，非常经典的一种格式（似乎也叫 Hermes 风格），<strong>函数名和参数放到同一个字典中传递</strong></li><li>并行工具调用也非常方便，<strong>直接串联即可</strong>：<code>&lt;tool_call&gt;...&lt;/tool_call&gt;&lt;tool_call&gt;...&lt;/tool_call&gt;</code>，工具返回结果也按顺序串联</li><li>关于 <code>&lt;think&gt;&lt;/think&gt;</code> 的拼接有一个坑点：最后一次 User Query 前的历史思考内容会被省略，具体设计不在本文的讨论范围～</li></ol><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs pf"><span class="hljs-variable">&lt;|im_start|&gt;</span>system<br>You are a helpful assistant that can use tools <span class="hljs-keyword">to</span> get information <span class="hljs-keyword">for</span> the <span class="hljs-keyword">user</span>.<br><br><span class="hljs-comment"># Tools</span><br><br>You may call one or more functions <span class="hljs-keyword">to</span> assist with the <span class="hljs-keyword">user</span> query.<br><br>You are provided with function signatures within <span class="hljs-variable">&lt;tools&gt;</span>&lt;/tools&gt; XML tags:<br><span class="hljs-variable">&lt;tools&gt;</span><br>&#123;<span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;get_weather&quot;</span>, <span class="hljs-string">&quot;description&quot;</span>: <span class="hljs-string">&quot;Get current weather information for a location&quot;</span>, <span class="hljs-string">&quot;parameters&quot;</span>: &#123;<span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;object&quot;</span>, <span class="hljs-string">&quot;properties&quot;</span>: &#123;<span class="hljs-string">&quot;location&quot;</span>: &#123;<span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span>, <span class="hljs-string">&quot;description&quot;</span>: <span class="hljs-string">&quot;The city and state, e.g. San Francisco, CA&quot;</span>&#125;&#125;, <span class="hljs-string">&quot;required&quot;</span>: [<span class="hljs-string">&quot;location&quot;</span>]&#125;&#125;<br>&lt;/tools&gt;<br><br>For each function call, return a json object with function name and arguments within <span class="hljs-variable">&lt;tool_call&gt;</span>&lt;/tool_call&gt; XML tags:<br><span class="hljs-variable">&lt;tool_call&gt;</span><br>&#123;<span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-variable">&lt;function-name&gt;</span>, <span class="hljs-string">&quot;arguments&quot;</span>: <span class="hljs-variable">&lt;args-json-object&gt;</span>&#125;<br>&lt;/tool_call&gt;<span class="hljs-variable">&lt;|im_end|&gt;</span><br><br><span class="hljs-variable">&lt;|im_start|&gt;</span><span class="hljs-keyword">user</span><br>What&#x27;s the weather like <span class="hljs-keyword">in</span> New York?<span class="hljs-variable">&lt;|im_end|&gt;</span><br><br><span class="hljs-variable">&lt;|im_start|&gt;</span>assistant<br>I&#x27;ll check the current weather <span class="hljs-keyword">in</span> New York <span class="hljs-keyword">for</span> you.<br><span class="hljs-variable">&lt;tool_call&gt;</span><br>&#123;<span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;get_weather&quot;</span>, <span class="hljs-string">&quot;arguments&quot;</span>: &#123;<span class="hljs-string">&quot;location&quot;</span>: <span class="hljs-string">&quot;New York&quot;</span>&#125;&#125;<br>&lt;/tool_call&gt;<span class="hljs-variable">&lt;|im_end|&gt;</span><br><br><span class="hljs-variable">&lt;|im_start|&gt;</span><span class="hljs-keyword">user</span><br><span class="hljs-variable">&lt;tool_response&gt;</span><br>&#123;<span class="hljs-string">&quot;temperature&quot;</span>: <span class="hljs-number">22</span>, <span class="hljs-string">&quot;condition&quot;</span>: <span class="hljs-string">&quot;Sunny&quot;</span>, <span class="hljs-string">&quot;humidity&quot;</span>: <span class="hljs-number">45</span>, <span class="hljs-string">&quot;wind_speed&quot;</span>: <span class="hljs-number">10</span>&#125;<br>&lt;/tool_response&gt;<span class="hljs-variable">&lt;|im_end|&gt;</span><br><br><span class="hljs-variable">&lt;|im_start|&gt;</span>assistant<br>The weather <span class="hljs-keyword">in</span> New York is currently sunny with a temperature of <span class="hljs-number">22</span>°C. The humidity is at <span class="hljs-number">45</span>% with a wind speed of <span class="hljs-number">10</span> km/h. It&#x27;s a great day <span class="hljs-keyword">to</span> be outside!<span class="hljs-variable">&lt;|im_end|&gt;</span><br><br><span class="hljs-variable">&lt;|im_start|&gt;</span><span class="hljs-keyword">user</span><br>Thanks! What about Boston and Paris?<span class="hljs-variable">&lt;|im_end|&gt;</span><br><br><span class="hljs-variable">&lt;|im_start|&gt;</span>assistant<br><span class="hljs-variable">&lt;think&gt;</span><br>The <span class="hljs-keyword">user</span> is now asking about the weather <span class="hljs-keyword">in</span> two different cities: Boston and Paris. I need <span class="hljs-keyword">to</span> call the weather tool twice - <span class="hljs-keyword">once</span> <span class="hljs-keyword">for</span> Boston and <span class="hljs-keyword">once</span> <span class="hljs-keyword">for</span> Paris.<br>&lt;/think&gt;<br><br>I&#x27;ll check the weather <span class="hljs-keyword">in</span> both Boston and Paris <span class="hljs-keyword">for</span> you.<br><span class="hljs-variable">&lt;tool_call&gt;</span><br>&#123;<span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;get_weather&quot;</span>, <span class="hljs-string">&quot;arguments&quot;</span>: &#123;<span class="hljs-string">&quot;location&quot;</span>: <span class="hljs-string">&quot;Boston&quot;</span>&#125;&#125;<br>&lt;/tool_call&gt;<br><span class="hljs-variable">&lt;tool_call&gt;</span><br>&#123;<span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;get_weather&quot;</span>, <span class="hljs-string">&quot;arguments&quot;</span>: &#123;<span class="hljs-string">&quot;location&quot;</span>: <span class="hljs-string">&quot;Paris&quot;</span>&#125;&#125;<br>&lt;/tool_call&gt;<span class="hljs-variable">&lt;|im_end|&gt;</span><br><br><span class="hljs-variable">&lt;|im_start|&gt;</span><span class="hljs-keyword">user</span><br><span class="hljs-variable">&lt;tool_response&gt;</span><br>&#123;<span class="hljs-string">&quot;temperature&quot;</span>: <span class="hljs-number">15</span>, <span class="hljs-string">&quot;condition&quot;</span>: <span class="hljs-string">&quot;Cloudy&quot;</span>, <span class="hljs-string">&quot;humidity&quot;</span>: <span class="hljs-number">70</span>, <span class="hljs-string">&quot;wind_speed&quot;</span>: <span class="hljs-number">12</span>&#125;<br>&lt;/tool_response&gt;<br><span class="hljs-variable">&lt;tool_response&gt;</span><br>&#123;<span class="hljs-string">&quot;temperature&quot;</span>: <span class="hljs-number">19</span>, <span class="hljs-string">&quot;condition&quot;</span>: <span class="hljs-string">&quot;Light Rain&quot;</span>, <span class="hljs-string">&quot;humidity&quot;</span>: <span class="hljs-number">80</span>, <span class="hljs-string">&quot;wind_speed&quot;</span>: <span class="hljs-number">8</span>&#125;<br>&lt;/tool_response&gt;<span class="hljs-variable">&lt;|im_end|&gt;</span><br><br><span class="hljs-variable">&lt;|im_start|&gt;</span>assistant<br></code></pre></td></tr></table></figure><h2 id="以-deepseek-v3.1-为代表的函数名字典形式">以 DeepSeek-V3.1 为代表的函数名+字典形式</h2><p>DeepSeek-V3.1 对话模板的特点：</p><ol type="1"><li>包含两种角色：user、assistant，其中系统消息默认放到最前方，<strong>工具返回结果无角色直接拼接</strong>！</li><li>基础的工具调用仅在非思考模型下进行，格式为：<code>&lt;｜begin▁of▁sentence｜&gt;&#123;system prompt&#125;\n\n&#123;tool_description&#125;&lt;｜User｜&gt;&#123;query&#125;&lt;｜Assistant｜&gt;&lt;/think&gt;</code></li><li>工具描述拼接在 system prompt 之后作为一部分，使用 Markdown 三级标题，并且会自动附上官方提示工程</li><li>工具调用格式为 <code>&lt;｜tool▁call▁begin｜&gt;tool_call_name&lt;｜tool▁sep｜&gt;tool_call_arguments&lt;｜tool▁call▁end｜&gt;</code>，<strong>函数名和参数字典分开传递，并用一个特殊 Token 分隔</strong></li><li>对于并行工具调用，则使用一个<strong>外部 Section</strong> 将整体包裹：<code>&lt;｜tool▁calls▁begin｜&gt;...&lt;｜tool▁calls▁end｜&gt;</code>，内部再串联拼接</li><li>注：DeepSeek-V3.1 将 Search Tool 的格式独立出来，作为一种特殊情况。本文文末会进行分析。</li></ol><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs pf"><span class="hljs-variable">&lt;｜begin▁of▁sentence｜&gt;</span>You are a helpful assistant that can use tools <span class="hljs-keyword">to</span> get information <span class="hljs-keyword">for</span> the <span class="hljs-keyword">user</span>.<br><br><span class="hljs-comment">## Tools</span><br>You have access <span class="hljs-keyword">to</span> the following tools:<br><br><span class="hljs-comment">### get_weather</span><br>Description: Get current weather information <span class="hljs-keyword">for</span> a location<br><br>Parameters: &#123;<span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;object&quot;</span>,<span class="hljs-string">&quot;properties&quot;</span>:&#123;<span class="hljs-string">&quot;location&quot;</span>:&#123;<span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;string&quot;</span>,<span class="hljs-string">&quot;description&quot;</span>:<span class="hljs-string">&quot;The city and state, e.g. San Francisco, CA&quot;</span>&#125;&#125;,<span class="hljs-string">&quot;required&quot;</span>:[<span class="hljs-string">&quot;location&quot;</span>]&#125;<br><br>IMPORTANT: ALWAYS adhere <span class="hljs-keyword">to</span> this exact format <span class="hljs-keyword">for</span> tool use:<br><span class="hljs-variable">&lt;｜tool▁calls▁begin｜&gt;</span><span class="hljs-variable">&lt;｜tool▁call▁begin｜&gt;</span>tool_call_name<span class="hljs-variable">&lt;｜tool▁sep｜&gt;</span>tool_call_arguments<span class="hljs-variable">&lt;｜tool▁call▁end｜&gt;</span>&#123;additional_tool_calls&#125;<span class="hljs-variable">&lt;｜tool▁calls▁end｜&gt;</span><br><br>Where:<br>- `tool_call_name` must be an exact <span class="hljs-built_in">match</span> <span class="hljs-keyword">to</span> one of the available tools<br>- `tool_call_arguments` must be valid JSON that strictly follows the tool&#x27;s Parameters Schema<br>- For multiple tool calls, chain them directly without separators or spaces<br><br><span class="hljs-variable">&lt;｜User｜&gt;</span>What&#x27;s the weather like <span class="hljs-keyword">in</span> New York?<br><br><span class="hljs-variable">&lt;｜Assistant｜&gt;</span>&lt;/think&gt;I&#x27;ll check the current weather <span class="hljs-keyword">in</span> New York <span class="hljs-keyword">for</span> you.<br><span class="hljs-variable">&lt;｜tool▁calls▁begin｜&gt;</span><br><span class="hljs-variable">&lt;｜tool▁call▁begin｜&gt;</span><br>get_weather<span class="hljs-variable">&lt;｜tool▁sep｜&gt;</span>&#123;<span class="hljs-string">&quot;location&quot;</span>: <span class="hljs-string">&quot;New York&quot;</span>&#125;<br><span class="hljs-variable">&lt;｜tool▁call▁end｜&gt;</span><br><span class="hljs-variable">&lt;｜tool▁calls▁end｜&gt;</span><br><span class="hljs-variable">&lt;｜end▁of▁sentence｜&gt;</span><br><br><span class="hljs-variable">&lt;｜tool▁output▁begin｜&gt;</span><br>&#123;<span class="hljs-string">&quot;temperature&quot;</span>: <span class="hljs-number">22</span>, <span class="hljs-string">&quot;condition&quot;</span>: <span class="hljs-string">&quot;Sunny&quot;</span>, <span class="hljs-string">&quot;humidity&quot;</span>: <span class="hljs-number">45</span>, <span class="hljs-string">&quot;wind_speed&quot;</span>: <span class="hljs-number">10</span>&#125;<br><span class="hljs-variable">&lt;｜tool▁output▁end｜&gt;</span><br><br>The weather <span class="hljs-keyword">in</span> New York is currently sunny with a temperature of <span class="hljs-number">22</span>°C. The humidity is at <span class="hljs-number">45</span>% with a wind speed of <span class="hljs-number">10</span> km/h. It&#x27;s a great day <span class="hljs-keyword">to</span> be outside!<br><span class="hljs-variable">&lt;｜end▁of▁sentence｜&gt;</span><br><br><br><span class="hljs-variable">&lt;｜User｜&gt;</span>Thanks! What about Boston and Paris?<br><br><span class="hljs-variable">&lt;｜Assistant｜&gt;</span>&lt;/think&gt;I&#x27;ll check the weather <span class="hljs-keyword">in</span> both Boston and Paris <span class="hljs-keyword">for</span> you.<br><span class="hljs-variable">&lt;｜tool▁calls▁begin｜&gt;</span><br><span class="hljs-variable">&lt;｜tool▁call▁begin｜&gt;</span><br>get_weather<span class="hljs-variable">&lt;｜tool▁sep｜&gt;</span>&#123;<span class="hljs-string">&quot;location&quot;</span>: <span class="hljs-string">&quot;Boston&quot;</span>&#125;<br><span class="hljs-variable">&lt;｜tool▁call▁end｜&gt;</span><br><span class="hljs-variable">&lt;｜tool▁call▁begin｜&gt;</span><br>get_weather<span class="hljs-variable">&lt;｜tool▁sep｜&gt;</span>&#123;<span class="hljs-string">&quot;location&quot;</span>: <span class="hljs-string">&quot;Paris&quot;</span>&#125;<br><span class="hljs-variable">&lt;｜tool▁call▁end｜&gt;</span><br><span class="hljs-variable">&lt;｜tool▁calls▁end｜&gt;</span><br><span class="hljs-variable">&lt;｜end▁of▁sentence｜&gt;</span><br><br><span class="hljs-variable">&lt;｜tool▁output▁begin｜&gt;</span><br>&#123;<span class="hljs-string">&quot;temperature&quot;</span>: <span class="hljs-number">15</span>, <span class="hljs-string">&quot;condition&quot;</span>: <span class="hljs-string">&quot;Cloudy&quot;</span>, <span class="hljs-string">&quot;humidity&quot;</span>: <span class="hljs-number">70</span>, <span class="hljs-string">&quot;wind_speed&quot;</span>: <span class="hljs-number">12</span>&#125;<br><span class="hljs-variable">&lt;｜tool▁output▁end｜&gt;</span><br><span class="hljs-variable">&lt;｜tool▁output▁begin｜&gt;</span><br>&#123;<span class="hljs-string">&quot;temperature&quot;</span>: <span class="hljs-number">19</span>, <span class="hljs-string">&quot;condition&quot;</span>: <span class="hljs-string">&quot;Light Rain&quot;</span>, <span class="hljs-string">&quot;humidity&quot;</span>: <span class="hljs-number">80</span>, <span class="hljs-string">&quot;wind_speed&quot;</span>: <span class="hljs-number">8</span>&#125;<br><span class="hljs-variable">&lt;｜tool▁output▁end｜&gt;</span><br></code></pre></td></tr></table></figure><blockquote><p>注：在使用 DeepSeek-V3.1 的 JSON Input 的时候，需要去掉思考过程，以及将工具传参 Argument 改为字符串。</p></blockquote><p>与 DeepSeek-V3.1 相似，Kimi-K2 也是函数名+参数字典，这里仅展示工具调用部分：</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs gherkin"><span class="hljs-variable">&lt;|im_assistant|&gt;</span>assistant<span class="hljs-variable">&lt;|im_middle|&gt;</span>I&#x27;ll check the weather in both Boston and Paris for you.<br><span class="hljs-variable">&lt;|tool_calls_section_begin|&gt;</span><br><span class="hljs-variable">&lt;|tool_call_begin|&gt;</span>call_2<span class="hljs-variable">&lt;|tool_call_argument_begin|&gt;</span>&#123;<span class="hljs-string">&quot;location&quot;</span>: <span class="hljs-string">&quot;Boston&quot;</span>&#125;<span class="hljs-variable">&lt;|tool_call_end|&gt;</span><br><span class="hljs-variable">&lt;|tool_call_begin|&gt;</span>call_3<span class="hljs-variable">&lt;|tool_call_argument_begin|&gt;</span>&#123;<span class="hljs-string">&quot;location&quot;</span>: <span class="hljs-string">&quot;Paris&quot;</span>&#125;<span class="hljs-variable">&lt;|tool_call_end|&gt;</span><br><span class="hljs-variable">&lt;|tool_calls_section_end|&gt;</span><span class="hljs-variable">&lt;|im_end|&gt;</span><br></code></pre></td></tr></table></figure><p>值得一提的是，OpenAI 开源的 gpt-oss 也是函数名+参数字典，但有一些特殊的地方：</p><ol type="1"><li>使用与 OpenAI API 模型中相同的 System 和 Developer 消息角色（<strong>Instruction Hierarchy</strong>）。通过这些角色，模型遵循基于角色的信息层级来解决指令冲突：System &gt; Developer &gt; User &gt; Assistant &gt; Tool，这种方法会更加安全</li><li>引入 Channels 来表明每条消息的<strong>预期可见性</strong>，例如，用于推理过程（CoT）的分析 Channels、用于函数工具调用的评论 Channels，以及用于展示给用户的最终答案 Channels</li><li>由于 Channels 的存在，整体会更复杂：<code>&lt;|start|&gt;assistant to=functions.name&lt;|channel|&gt;commentary json&lt;|message|&gt;function_arguments&lt;|call|&gt;</code></li><li>不支持并行工具调用！在对话模板中明确提到：We assume max 1 tool call per message...，不知道出于什么考虑</li></ol><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">&lt;|<span class="hljs-keyword">start</span>|&gt;<span class="hljs-keyword">system</span>&lt;|message|&gt;You are ChatGPT, a <span class="hljs-keyword">large</span> <span class="hljs-keyword">language</span> model trained <span class="hljs-keyword">by</span> OpenAI.<br>Knowledge cutoff: <span class="hljs-number">2024</span><span class="hljs-number">-06</span><br><span class="hljs-keyword">Current</span> <span class="hljs-type">date</span>: <span class="hljs-number">2025</span><span class="hljs-number">-08</span><span class="hljs-number">-26</span><br><br>Reasoning: medium<br><br># <span class="hljs-keyword">Valid</span> channels: analysis, commentary, final. Channel must be included <span class="hljs-keyword">for</span> every message.&lt;|<span class="hljs-keyword">end</span>|&gt;&lt;|<span class="hljs-keyword">start</span>|&gt;developer&lt;|message|&gt;# Instructions<br><br>Environment: ipython<br>Cutting Knowledge <span class="hljs-type">Date</span>: December <span class="hljs-number">2023</span><br>Today <span class="hljs-type">Date</span>: <span class="hljs-number">2025</span><span class="hljs-number">-05</span><span class="hljs-number">-14</span><br><br>You are a helpful assistant.<br><br>&lt;|<span class="hljs-keyword">end</span>|&gt;&lt;|<span class="hljs-keyword">start</span>|&gt;<span class="hljs-keyword">user</span>&lt;|message|&gt;Given the <span class="hljs-keyword">following</span> <span class="hljs-keyword">functions</span>, please respond <span class="hljs-keyword">with</span> a <span class="hljs-type">JSON</span> <span class="hljs-keyword">for</span> a <span class="hljs-keyword">function</span> <span class="hljs-keyword">call</span> <span class="hljs-keyword">with</span> its proper arguments that best answers the given prompt.<br><br>Respond <span class="hljs-keyword">in</span> the <span class="hljs-keyword">format</span> &#123;&quot;name&quot;: <span class="hljs-keyword">function</span> <span class="hljs-type">name</span>, &quot;parameters&quot;: <span class="hljs-keyword">dictionary</span> <span class="hljs-keyword">of</span> argument <span class="hljs-type">name</span> <span class="hljs-keyword">and</span> its <span class="hljs-keyword">value</span>&#125;.<br><span class="hljs-keyword">Do</span> <span class="hljs-keyword">not</span> use variables.<br><br>[<br>  &#123;<br>    &quot;name&quot;: &quot;get_weather&quot;,<br>    &quot;description&quot;: &quot;Get current weather information for a location&quot;,<br>    &quot;parameters&quot;: &#123;<br>      &quot;type&quot;: &quot;object&quot;,<br>      &quot;properties&quot;: &#123;<br>        &quot;location&quot;: &#123;<br>          &quot;type&quot;: &quot;string&quot;,<br>          &quot;description&quot;: &quot;The city and state, e.g. San Francisco, CA&quot;<br>        &#125;,<br>      &quot;required&quot;: [&quot;location&quot;]<br>    &#125;<br>  &#125;<br>]<br><br>What<span class="hljs-string">&#x27;s the weather like in New York?&lt;|end|&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">&lt;|start|&gt;assistant to=functions.get_weather&lt;|channel|&gt;commentary json&lt;|message|&gt;</span><br><span class="hljs-string">&#123;&quot;location&quot;: &quot;New York&quot;&#125;&lt;|call|&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">&lt;|start|&gt;functions.get_weather to=assistant&lt;|channel|&gt;commentary&lt;|message|&gt;</span><br><span class="hljs-string">&quot;&#123;\&quot;temperature\&quot;: 22, \&quot;condition\&quot;: \&quot;Sunny\&quot;, \&quot;humidity\&quot;: 45, \&quot;wind_speed\&quot;: 10&#125;&quot;&lt;|end|&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">&lt;|start|&gt;assistant&lt;|channel|&gt;final&lt;|message|&gt;</span><br><span class="hljs-string">The weather in New York is currently sunny with a temperature of 22°C. The humidity is at 45% with a wind speed of 10 km/h. It&#x27;</span>s a great day <span class="hljs-keyword">to</span> be outside!&lt;|<span class="hljs-keyword">end</span>|&gt;<br><br>&lt;|<span class="hljs-keyword">start</span>|&gt;<span class="hljs-keyword">user</span>&lt;|message|&gt;Thanks! What about Boston?&lt;|<span class="hljs-keyword">end</span>|&gt;<br><br>&lt;|<span class="hljs-keyword">start</span>|&gt;assistant<br></code></pre></td></tr></table></figure><h2 id="以-glm-4.5-为代表的参数隔离形式">以 GLM-4.5 为代表的参数隔离形式</h2><p>GLM-4.5 的技术报告中提到，函数调用模板中存在字符转义问题：</p><blockquote><p>虽然在现代实现中，函数调用参数主要以 JSON 格式表示，但当这些参数包含代码段时，会出现一个重大挑战 —— 在这种情况下，<strong>代码中的大量字符需要转义，迫使模型生成大量的转义字符</strong>，从而增加了模型的学习负担。</p><p>尽管这一问题对于主要用于聊天的模型而言影响较小，但对于以函数调用为核心能力的智能体基础模型来说，却是一个非 trivial 的挑战。为了解决这一限制，我们<strong>提出了一种新的函数调用模板，该模板使用类似 XML 的特殊标记标签来封装函数调用的键和值</strong>。</p><p>这种方法显著减少了代码段中字符转义的必要性，因为大多数代码可以以原生形式表示而无需转义。实验结果表明，所提出的函数调用模板在减少转义的同时，并未影响函数调用执行的性能。</p></blockquote><p>GLM-4.5 对话模板的特点：</p><ol type="1"><li>包含四种角色：system、user、assistant、observation，有各自的特殊 Token，其中<strong>工具返回结果以 observation 角色拼接</strong>（不同于 Qwen 直接复用 user 角色）</li><li>工具描述拼接在 system prompt 之后作为一部分，使用 <code>&lt;tools&gt;&lt;/tools&gt;</code> XML tags 包裹</li><li>工具调用格式为 <code>&lt;tool_call&gt;&#123;function-name&#125;&lt;arg_key&gt;&#123;arg-key-1&#125;&lt;/arg_key&gt;&lt;arg_value&gt;&#123;arg-value-1&#125;&lt;/arg_value&gt;&lt;/tool_call&gt;</code>，<strong>每个参数的键值对隔离开，省去 JSON 字典</strong></li><li>并行工具调用也非常方便，<strong>直接串联即可</strong>：<code>&lt;tool_call&gt;...&lt;/tool_call&gt;&lt;tool_call&gt;...&lt;/tool_call&gt;</code>，工具返回结果也按顺序串联</li></ol><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-params">&lt;|system|&gt;</span><br><span class="hljs-meta"># Tools</span><br>You may call one or more functions to assist with the user query.<br>You are provided with function signatures within <span class="hljs-params">&lt;tools&gt;</span><span class="hljs-params">&lt;/tools&gt;</span> XML tags:<br><span class="hljs-params">&lt;tools&gt;</span><br>&#123;<br>  <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;get_weather&quot;</span>,<br>  <span class="hljs-string">&quot;description&quot;</span>: <span class="hljs-string">&quot;Get the weather of a city for a specific date.&quot;</span>,<br>  <span class="hljs-string">&quot;parameters&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;object&quot;</span>,<br>    <span class="hljs-string">&quot;properties&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;city&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span>,<br>        <span class="hljs-string">&quot;description&quot;</span>: <span class="hljs-string">&quot;The city to get weather for, in Chinese.&quot;</span><br>      &#125;,<br>      <span class="hljs-string">&quot;date&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span>,<br>        <span class="hljs-string">&quot;description&quot;</span>: <span class="hljs-string">&quot;The date in YYYY-MM-DD format.&quot;</span><br>      &#125;<br>    &#125;,<br>    <span class="hljs-string">&quot;required&quot;</span>: [<span class="hljs-string">&quot;city&quot;</span>]<br>  &#125;<br>&#125;<br><span class="hljs-params">&lt;/tools&gt;</span><br><br>For each function call, output the function name and arguments within the following XML format:<br><span class="hljs-params">&lt;tool_call&gt;</span><br>&#123;function-name&#125;<br><span class="hljs-params">&lt;arg_key&gt;</span>&#123;arg-key<span class="hljs-number">-1</span>&#125;<span class="hljs-params">&lt;/arg_key&gt;</span><br><span class="hljs-params">&lt;arg_value&gt;</span>&#123;arg-value<span class="hljs-number">-1</span>&#125;<span class="hljs-params">&lt;/arg_value&gt;</span><br><span class="hljs-params">&lt;arg_key&gt;</span>&#123;arg-key<span class="hljs-number">-2</span>&#125;<span class="hljs-params">&lt;/arg_key&gt;</span><br><span class="hljs-params">&lt;arg_value&gt;</span>&#123;arg-value<span class="hljs-number">-2</span>&#125;<span class="hljs-params">&lt;/arg_value&gt;</span><br>...<br><span class="hljs-params">&lt;/tool_call&gt;</span><br><br><span class="hljs-params">&lt;|system|&gt;</span><br>You are a helpful assistant.<br><br><span class="hljs-params">&lt;|user|&gt;</span><br>Today is June <span class="hljs-number">26</span>, <span class="hljs-number">2024.</span> Could you please check the weather in Beijing and Shanghai for tomorrow?<br><br><span class="hljs-params">&lt;|assistant|&gt;</span><br><span class="hljs-params">&lt;think&gt;</span><br>The user wants to check the weather of Beijing and Shanghai tomorrow. I need to call the get_weather function respectively to check Beijing and Shanghai.<br><span class="hljs-params">&lt;/think&gt;</span><br><br>I will call the get_weather function to check the weather in Beijing and Shanghai.<br><span class="hljs-params">&lt;tool_call&gt;</span>get_weather<br><span class="hljs-params">&lt;arg_key&gt;</span>city<span class="hljs-params">&lt;/arg_key&gt;</span><br><span class="hljs-params">&lt;arg_value&gt;</span>Beijing<span class="hljs-params">&lt;/arg_value&gt;</span><br><span class="hljs-params">&lt;arg_key&gt;</span>date<span class="hljs-params">&lt;/arg_key&gt;</span><br><span class="hljs-params">&lt;arg_value&gt;</span><span class="hljs-number">2024</span><span class="hljs-number">-06</span><span class="hljs-number">-27</span><span class="hljs-params">&lt;/arg_value&gt;</span><br><span class="hljs-params">&lt;/tool_call&gt;</span><br><span class="hljs-params">&lt;tool_call&gt;</span>get_weather<br><span class="hljs-params">&lt;arg_key&gt;</span>city<span class="hljs-params">&lt;/arg_key&gt;</span><br><span class="hljs-params">&lt;arg_value&gt;</span>Shanghai<span class="hljs-params">&lt;/arg_value&gt;</span><br><span class="hljs-params">&lt;arg_key&gt;</span>date<span class="hljs-params">&lt;/arg_key&gt;</span><br><span class="hljs-params">&lt;arg_value&gt;</span><span class="hljs-number">2024</span><span class="hljs-number">-06</span><span class="hljs-number">-27</span><span class="hljs-params">&lt;/arg_value&gt;</span><br><span class="hljs-params">&lt;/tool_call&gt;</span><br><br><span class="hljs-params">&lt;|observation|&gt;</span><br><span class="hljs-params">&lt;tool_response&gt;</span><br>&#123;<br>  <span class="hljs-string">&quot;city&quot;</span>: <span class="hljs-string">&quot;Beijing&quot;</span>,<br>  <span class="hljs-string">&quot;date&quot;</span>: <span class="hljs-string">&quot;2024-06-27&quot;</span>,<br>  <span class="hljs-string">&quot;weather&quot;</span>: <span class="hljs-string">&quot;Sunny&quot;</span>,<br>  <span class="hljs-string">&quot;temperature&quot;</span>: <span class="hljs-string">&quot;26C&quot;</span><br>&#125;<br><span class="hljs-params">&lt;/tool_response&gt;</span><br><span class="hljs-params">&lt;tool_response&gt;</span><br>&#123;<br>  <span class="hljs-string">&quot;city&quot;</span>: <span class="hljs-string">&quot;Shanghai&quot;</span>,<br>  <span class="hljs-string">&quot;date&quot;</span>: <span class="hljs-string">&quot;2024-06-27&quot;</span>,<br>  <span class="hljs-string">&quot;weather&quot;</span>: <span class="hljs-string">&quot;Overcast&quot;</span>,<br>  <span class="hljs-string">&quot;temperature&quot;</span>: <span class="hljs-string">&quot;29C&quot;</span><br>&#125;<br><span class="hljs-params">&lt;/tool_response&gt;</span><br><br><span class="hljs-params">&lt;|assistant|&gt;</span><br><span class="hljs-params">&lt;think&gt;</span><br>I have obtained the weather query results of get_weather for Beijing and Shanghai respectively and can reply to users directly.<br><span class="hljs-params">&lt;/think&gt;</span><br>It will be sunny in Beijing tomorrow with a temperature of <span class="hljs-number">26</span> degrees Celsius. The weather in Shanghai is overcast with a temperature of <span class="hljs-number">29</span> degrees Celsius.<br></code></pre></td></tr></table></figure><p>最近开源的 Seed-OSS-36B 也使用了类似的参数隔离形式，但是会将参数名放到 XML tags 中（不知道会不会对 tokenize 造成影响），这里仅展示工具调用部分：</p><figure class="highlight bnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bnf"><span class="hljs-attribute">&lt;seed:tool_call&gt;</span><br><span class="hljs-attribute">&lt;function=example_function_name&gt;</span><br><span class="hljs-attribute">&lt;parameter=example_parameter_1&gt;</span>value_1<span class="hljs-attribute">&lt;/parameter&gt;</span><br><span class="hljs-attribute">&lt;parameter=example_parameter_2&gt;</span>This is the value for the second parameter<br>that can span<br>multiple lines<span class="hljs-attribute">&lt;/parameter&gt;</span><br><span class="hljs-attribute">&lt;/function&gt;</span><br><span class="hljs-attribute">&lt;/seed:tool_call&gt;</span><br></code></pre></td></tr></table></figure><h2 id="附deepseek-v3.1-的-search-agent-特殊模式分析">附：DeepSeek-V3.1 的 Search Agent 特殊模式分析</h2><p>DeepSeek-V3.1 声称为在思考模式下搜索工具调用设计了特定的格式，以支持 Search Agent —— 注意，其他工具则是在非思考模式中完成。现在有一些工作也探讨了 thinking effort 对于 Agent 任务表现的影响，例如 <a target="_blank" rel="noopener" href="https://arxiv.org/abs/2506.07976">Thinking vs. Doing</a>、<a target="_blank" rel="noopener" href="https://arxiv.org/abs/2507.02592">WebSailor</a>。</p><p>个人猜测 DeepSeek 这样做的动机可能是发现了一些困难的榜单<strong>如果不思考根本刷不上去</strong>（例如 BrowseComp），为了防止几种模式冲突，所以单独设置了一个 pattern 告诉模型「现在是搜索任务」。</p><p>官方仓库 <code>assets/search_tool_trajectory.html</code> 中提供了一个例子，可以看到：</p><ol type="1"><li><strong>Search 一个工具就集成了常规的 Search+Browse 功能</strong>，在工具返回结果中包括 snippet 和 content（这合理吗？几次调用就超 128k 了）</li><li>虽然说的是思考模式，但<strong>并非使用常规思考的<think></think></strong>，而是用 <code>&lt;｜search▁begin｜&gt;&lt;｜search▁end｜&gt;</code> 包裹了整个搜索交互过程作为思考（并不是之前一些文章猜测的 Search-R1 形式的特殊 Token 包裹查询）</li><li>在 <code>&lt;｜search▁end｜&gt;</code> 之后的回答会引用搜索过程中的文档，风格看起来像是 Deep Research 最后的 Report 生成</li></ol><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><code class="hljs markdown">&lt;｜User｜&gt;The current date is 2025-08-16, Saturday. Your primary task is to solve the user&#x27;s questions, leveraging the appropriate tools as needed.<br>[Core Instruction: Language Consistency]<br>You MUST write your entire response in the same language as the user&#x27;s question.<br>If the user asks in Chinese, you must think and write in Chinese.<br>If the user asks in French, you must think and write in French.<br>Do not switch to English unless the user&#x27;s question was in English. This applies to your reasoning, explanations, and the final answer.<br>[Core Instruction: Citation Formatting]<br>If the search tool was used and you are referencing a specific webpage in your final answer (the content after &lt;｜search▁end｜&gt;), you must use the format &quot;[citation:x]&quot;, where x is the corresponding webpage number.<br>You must first engage in step-by-step, rigorous thinking and reasoning before using the appropriate tool or providing the final answer.<br><br><br><span class="hljs-section">## Tools</span><br>You have access to the following tools:<br><br><span class="hljs-section">### search</span><br>Description: Search the web for information. The result will be a string.<br><br>Parameters: &#123;&quot;type&quot;: &quot;object&quot;, &quot;properties&quot;: &#123;&quot;questions&quot;: &#123;&quot;type&quot;: &quot;string&quot;, &quot;description&quot;: &quot;Generate up to 5 search queries based on the requirements below:\n\n- Separate different queries with \&quot;||\&quot;. For example: \&quot;Elon Musk lawsuit OpenAI reasons||Elon Musk lawsuit OpenAI latest updates\&quot;.\n- All search queries should use generalized, search engine-friendly, and easily retrievable keywords to improve search efficiency and the relevance of results. Avoid directly extracting phrases from the question that are difficult to retrieve effectively. For example: Avoid using relative or ambiguous terms such as “third author” or “the following year.” - Instead, use more universal expressions like “author list” or “award history.”\n- For a single search query, keep them short - remove unnecessary auxiliary words, conjunctions, and interrogative words. Primarily use keyword combinations (separated by spaces). Ideally, they should not exceed 15 characters. Avoid using special punctuation marks.\n- When seeking information from non-English primary sources, adjust search query to retrieve content in the original language (e.g., chinese), even if your initial question is in English. This improves accuracy and avoids translation-related errors.\n- You can search 1 to 5 search queries in parallel each time. If the question involves comparing multiple entities (e.g., people, places, books, movies) or contains two or more sub-questions, please split it into separate queries for each entity or sub-question.\n- Do not re-search for queries that have already been searched.&quot;&#125;&#125;, &quot;required&quot;: [&quot;questions&quot;]&#125;<br><br>IMPORTANT: ALWAYS adhere to this exact format for tool use:<br>&lt;｜tool▁calls▁begin｜&gt;&lt;｜tool▁call▁begin｜&gt;tool<span class="hljs-emphasis">_call_</span>name&lt;｜tool▁sep｜&gt;tool<span class="hljs-emphasis">_call_</span>arguments&lt;｜tool▁call▁end｜&gt;&#123;additional<span class="hljs-emphasis">_tool_</span>calls&#125;&lt;｜tool▁calls▁end｜&gt;<br><br>Where:<br><span class="hljs-bullet">-</span> <span class="hljs-code">`tool_call_name`</span> must be an exact match to one of the available tools<br><span class="hljs-bullet">-</span> <span class="hljs-code">`tool_call_arguments`</span> must be valid JSON that strictly follows the tool&#x27;s Parameters Schema<br><span class="hljs-bullet">-</span> For multiple tool calls, chain them directly without separators or spaces<br><br><span class="hljs-section"># The user&#x27;s message is: 有一个全球旗舰店被称为“博物馆”的品牌，在2025年5月初与一家中国度假酒店集团进行的品牌联名，这次联名的宣传片的艺术指导是谁？&lt;｜Assistant｜&gt;<span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">think</span>&gt;</span></span>&lt;｜search▁begin｜&gt;</span><br><br>我们将逐步解决这个问题。首先，我们需要找到符合以下条件的品牌：<br><br><span class="hljs-bullet">1.</span> 全球旗舰店被称为“博物馆”的品牌。<br><span class="hljs-bullet">2.</span> 在2025年5月初与一家中国度假酒店集团进行品牌联名。<br><span class="hljs-bullet">3.</span> 联名宣传片的艺术指导是谁？<br><br><span class="hljs-section">### 第一步：全球旗舰店被称为“博物馆”的品牌</span><br><br>首先，我们需要找到全球旗舰店被称为“博物馆”的品牌。可能的候选包括：<br><br>[……]<br><br><span class="hljs-section">### 搜索符合条件的品牌</span><br><br>我将先搜索符合条件的品牌。&lt;｜tool▁calls▁begin｜&gt;&lt;｜tool▁call▁begin｜&gt;search&lt;｜tool▁sep｜&gt;&#123;&quot;questions&quot;:&quot;全球旗舰店被称为博物馆的品牌||全球旗舰店博物馆||Aesop全球旗舰店博物馆||Aesop旗舰店博物馆||Nike全球旗舰店博物馆&quot;&#125;&lt;｜tool▁call▁end｜&gt;&lt;｜tool▁calls▁end｜&gt;&lt;｜end▁of▁sentence｜&gt;&lt;｜tool▁output▁begin｜&gt;[webpage 0 begin]<br>[webpage title]始祖鸟在它的“博物馆”里如何讲户外故事？<br>[webpage url]https://wap.eastmoney.com/a/202405213082252819.html<br>[webpage date published]<br>[webpage snippet begin]<br>2024年5月21日 — 如何低门槛投资美股？ 5月18日，位于上海南京西路的始祖鸟全球旗舰店正式开业，而这家店的另一个名称是“始祖鸟博物馆”。一楼和二楼则是多种产品线的零售 ...<br>[webpage snippet end]<br>[webpage content begin]<br>[……]<br>[webpage content end]<br>[webpage 0 end]<br>[……]<br>&lt;｜tool▁output▁end｜&gt;根据搜索结果，符合条件的品牌是始祖鸟（Arc&#x27;teryx）。其全球旗舰店被称为“始祖鸟博物馆”，位于上海南京西路。<br><br><span class="hljs-section">### 第二步：品牌联名</span><br><br>根据问题描述，始祖鸟在2025年5月初与一家中国度假酒店集团进行品牌联名。我们需要找到这次联名的宣传片艺术指导。<br><br><span class="hljs-section">#### 关键点：</span><br><br><span class="hljs-bullet">1.</span> <span class="hljs-strong">**时间**</span>：2025年5月初（由于当前时间是2025年8月16日，而联名发生在2025年5月初，因此可能需要搜索相关新闻或公告）。<br><span class="hljs-bullet">2.</span> <span class="hljs-strong">**联名对象**</span>：一家中国度假酒店集团。<br><span class="hljs-bullet">3.</span> <span class="hljs-strong">**联名内容**</span>：品牌联名，宣传片的艺术指导。<br><br><span class="hljs-section">### 第三步：始祖鸟的联名活动</span><br><br>我需要先找到始祖鸟在2025年5月初与中国度假酒店集团的联名活动。可能的度假酒店集团包括：<br><br><span class="hljs-bullet">1.</span> <span class="hljs-strong">**松赞酒店**</span>：始祖鸟曾与松赞酒店合作过（根据之前的文章提到）。<br><span class="hljs-bullet">2.</span> <span class="hljs-strong">**安缦酒店**</span>：高端度假酒店。<br><span class="hljs-bullet">3.</span> <span class="hljs-strong">**悦榕庄**</span>：度假酒店集团。<br><span class="hljs-bullet">4.</span> <span class="hljs-strong">**Club Med**</span>：度假村集团。<br><span class="hljs-bullet">5.</span> <span class="hljs-strong">**华住集团**</span>：旗下有度假酒店品牌，但可能不符合“度假酒店集团”的描述。<br><span class="hljs-bullet">6.</span> <span class="hljs-strong">**开元酒店集团**</span>：度假酒店品牌。<br><span class="hljs-bullet">7.</span> <span class="hljs-strong">**柏联酒店**</span>：高端度假酒店。<br><br>根据之前的文章提到，始祖鸟曾与松赞酒店合作过联名服饰。因此，松赞酒店可能是联名对象之一。<br><br><span class="hljs-section">### 第四步：搜索联名活动</span><br><br>我需要搜索始祖鸟在2025年5月初与中国度假酒店集团的联名活动。我将先尝试搜索相关新闻。&lt;｜tool▁calls▁begin｜&gt;&lt;｜tool▁call▁begin｜&gt;search&lt;｜tool▁sep｜&gt;&#123;&quot;questions&quot;:&quot;始祖鸟2025年5月联名||始祖鸟2025年5月酒店联名||始祖鸟度假酒店联名||始祖鸟宣传片艺术指导||始祖鸟松赞联名2025&quot;&#125;&lt;｜tool▁call▁end｜&gt;&lt;｜tool▁calls▁end｜&gt;&lt;｜end▁of▁sentence｜&gt;&lt;｜tool▁output▁begin｜&gt;[webpage 19 begin]<br>[webpage title]始祖鸟× 松赞相约纳木错<br>[webpage url]https://socialbeta.com/campaign/24810<br>[webpage date published]<br>[webpage snippet begin]<br>始祖鸟与中国高端旅行品牌松赞再次携手，推出以「圣湖」纳木措为灵感的全新联名系列。这已是双方继以两座神山——卡瓦格博与南迦巴瓦为灵感之后的第三次 ...<br>[webpage snippet end]<br>[webpage content begin]<br>[……]<br>[webpage content end]<br>[webpage 19 end]<br>[……]<br>&lt;｜tool▁output▁end｜&gt;根据搜索结果，始祖鸟在2025年5月初与松赞酒店集团进行了联名合作。这次联名以纳木措湖为灵感，推出了联名系列产品，并拍摄了概念影片《见水知蓝·纳木措》。<br><br><span class="hljs-section">### 第五步：宣传片的艺术指导</span><br><br>根据搜索结果，宣传片《见水知蓝·纳木措》的艺术指导是国际摄影大师杜可风（Christopher Doyle）。<br><br><span class="hljs-section">### 最终答案</span><br><br>根据搜索结果，始祖鸟与松赞酒店集团的联名宣传片《见水知蓝·纳木措》的艺术指导是杜可风（Christopher Doyle）。<br><br>&lt;｜search▁end｜&gt;<br><br>根据搜索结果，始祖鸟（Arc&#x27;teryx）在2025年5月初与中国度假酒店集团松赞（Songtsam）进行了品牌联名，推出了以纳木措湖为灵感的联名系列[<span class="hljs-string">citation:19</span>][<span class="hljs-symbol">citation:21</span>]。此次联名的宣传片《见水知蓝·纳木措》的艺术指导是国际摄影大师<span class="hljs-strong">**杜可风**</span>（Christopher Doyle）[citation:21]。<br><br><span class="hljs-section">### 联名背景：</span><br><span class="hljs-bullet">-</span> <span class="hljs-strong">**合作对象**</span>：始祖鸟 × 松赞（第三次合作，聚焦纳木措湖）[<span class="hljs-string">citation:19</span>][<span class="hljs-symbol">citation:21</span>]<br><span class="hljs-bullet">-</span> <span class="hljs-strong">**宣传片**</span>：《见水知蓝·纳木措》，以纳木措湖的“开湖”时刻为灵感，采用16:9宽幅画面和沉浸式叙事手法，展现高原自然与人文的共生哲学[citation:21]。<br><span class="hljs-bullet">-</span> <span class="hljs-strong">**艺术指导**</span>：杜可风（Christopher Doyle）担任艺术指导，将其标志性的蓝调美学融入影片，强调自然光影和真实记录[citation:21]。<br><br>如需进一步了解联名详情或宣传片内容，可以查阅或[<span class="hljs-string">citation:19</span>][<span class="hljs-symbol">citation:21</span>]。<br></code></pre></td></tr></table></figure></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/" class="category-chain-item">论文阅读</a> <span>></span> <a href="/categories/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/%E5%89%8D%E6%B2%BF%E7%83%AD%E7%82%B9/" class="category-chain-item">前沿热点</a></span></span></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/tags/LLMs/" class="print-no-link">#LLMs</a></div></div><div class="license-box my-3"><div class="license-title"><div>从近期开源模型看工具调用格式的分化</div><div>https://hwcoder.top/Tool-Call-Format</div></div><div class="license-meta"><div class="license-meta-item"><div>作者</div><div>Wei He</div></div><div class="license-meta-item license-meta-date"><div>发布于</div><div>2025年8月28日</div></div><div class="license-meta-item"><div>许可协议</div><div><a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><span class="hint--top hint--rounded" aria-label="BY - 署名"><i class="iconfont icon-by"></i> </span></a><a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><span class="hint--top hint--rounded" aria-label="NC - 非商业性使用"><i class="iconfont icon-nc"></i> </span></a><a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><span class="hint--top hint--rounded" aria-label="SA - 相同方式共享"><i class="iconfont icon-sa"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"></article><article class="post-next col-6"><a href="/Manual-Coding-6" title="手撕经典算法 #6 RLHF篇"><span class="hidden-mobile">手撕经典算法 #6 RLHF篇</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article id="comments" lazyload><div id="valine"></div><script type="text/javascript">Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/valine/1.5.1/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"jdbBr3BddTiqSCPnXw6sXFv7-gzGzoHsz","appKey":"2bjgwDr2opjVCwhgjDMpk53c","path":"window.location.pathname","placeholder":"说点什么吧( •̀ ω •́ )✧","avatar":"retro","meta":["nick","mail","link"],"requiredFields":["nick"],"pageSize":10,"lang":"zh-CN","highlight":true,"recordIP":true,"serverURLs":"","emojiCDN":null,"emojiMaps":null,"enableQQ":false},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          var imgSelector = '#valine .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });</script><noscript>Please enable JavaScript to view the comments</noscript></article></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i> <span>目录</span></p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a></div><div class="statistics"><span id="leancloud-site-pv-container" style="display:none">总访问量 <span id="leancloud-site-pv"></span> 次 </span><span id="leancloud-site-uv-container" style="display:none">总访客数 <span id="leancloud-site-uv"></span> 人</span></div></div></footer><script src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",function(){NProgress.done()})</script><script src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js"></script><script src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js"></script><script>!function(t){var e=Fluid.plugins.typing,i=t.getElementById("subtitle");i&&e&&e(i.getAttribute("data-typed-text"))}((window,document))</script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js",function(){var t,o=jQuery("#toc");0!==o.length&&window.tocbot&&(t=jQuery("#board-ctn").offset().top,window.tocbot.init(Object.assign({tocSelector:"#toc-body",contentSelector:".markdown-body",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,includeTitleTags:!0,headingsOffset:-t},CONFIG.toc)),0<o.find(".toc-list-item").length&&o.css("visibility","visible"),Fluid.events.registerRefreshCallback(function(){if("tocbot"in window){tocbot.refresh();var t=jQuery("#toc");if(0===t.length||!tocbot)return;0<t.find(".toc-list-item").length&&t.css("visibility","visible")}}))})</script><script src="https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });</script><script>Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",function(){Fluid.plugins.fancyBox()})</script><script>Fluid.plugins.imageCaption()</script><script defer src="/js/leancloud.js"></script><script src="/js/local-search.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div></noscript></body></html>