<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/logo.jpg"><link rel="icon" href="/img/logo.jpg"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"><meta name="theme-color" content="#01213a"><meta name="author" content="He Wei"><meta name="keywords" content="Computer Science and Technology, Machine Learning, Deep Learning, Computer Vision, Natural Language Processing"><meta name="baidu-site-verification" content="code-J3wrn8WJYJ"><meta name="google-site-verification" content="0p_KJKTfB8EcahVDp0vYRjVRhHFw1SBWHi15OakKHY0"><meta name="description" content="「数据库系统」课程项目，基于 MySQL+Django 实现校园食堂点餐系统，代码已开源于 GitHub。"><meta property="og:type" content="article"><meta property="og:title" content="DB课程项目-校园食堂点餐系统-开发文档"><meta property="og:url" content="https://hwcoder.top/DB-Project"><meta property="og:site_name" content="Hwcoder - Life Oriented Programming"><meta property="og:description" content="「数据库系统」课程项目，基于 MySQL+Django 实现校园食堂点餐系统，代码已开源于 GitHub。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://hwcoder.top/img/home/DB.jpg"><meta property="article:published_time" content="2021-11-21T03:21:25.000Z"><meta property="article:modified_time" content="2022-05-19T03:48:56.000Z"><meta property="article:author" content="He Wei"><meta property="article:tag" content="Database"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://hwcoder.top/img/home/DB.jpg"><title>DB课程项目-校园食堂点餐系统-开发文档 | Hwcoder - Life Oriented Programming</title><link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><link rel="stylesheet" href="/css/mac.css"><script id="fluid-configs">var Fluid=window.Fluid||{};Fluid.ctx=Object.assign({},Fluid.ctx);var dntVal,CONFIG={hostname:"hwcoder.top",root:"/",version:"1.9.0",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h2, h3",placement:"left",visible:"always",icon:"§"},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4",collapseDepth:3},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!0,follow_dnt:!0,baidu:null,google:null,gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:"XGNf4GEnaFLiUijMUvz8HSBF-gzGzoHsz",app_key:"JPeVLcug6EcWdBTpGrDJSdKi",server_url:"https://xgnf4gen.lc-cn-n1-shared.com",path:"window.location.pathname",ignore_local:!0}},search_path:"/local-search.xml"};CONFIG.web_analytics.follow_dnt&&(dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on")))</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><meta name="generator" content="Hexo 5.4.2"></head><body><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>Hwcoder</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> 首页</a></li><li class="nav-item"><a class="nav-link" href="/archives/"><i class="iconfont icon-archive-fill"></i> 归档</a></li><li class="nav-item"><a class="nav-link" href="/categories/"><i class="iconfont icon-category-fill"></i> 分类</a></li><li class="nav-item"><a class="nav-link" href="/tags/"><i class="iconfont icon-tags-fill"></i> 标签</a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> 关于我</a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">&nbsp;<i class="iconfont icon-search"></i>&nbsp;</a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(/img/bg/other.jpg) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle" data-typed-text="DB课程项目-校园食堂点餐系统-开发文档"></span></div><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2021-11-21 11:21" pubdate>2021年11月21日 上午</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 12k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 66 分钟 </span><span id="leancloud-page-views-container" class="post-meta" style="display:none"><i class="iconfont icon-eye" aria-hidden="true"></i> <span id="leancloud-page-views"></span> 次</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar category-bar" style="margin-right:-1rem"><div class="category-list"><div class="category row nomargin-x"><a class="category-item list-group-item category-item-action col-10 col-md-11 col-xm-11" title="项目经历" id="heading-b88758daa70ea87f4d698a4dac3c42fe" role="tab" data-toggle="collapse" href="#collapse-b88758daa70ea87f4d698a4dac3c42fe" aria-expanded="true">项目经历 <span class="list-group-count">(2)</span> <i class="iconfont icon-arrowright"></i></a><div class="category-collapse collapse show" id="collapse-b88758daa70ea87f4d698a4dac3c42fe" role="tabpanel" aria-labelledby="heading-b88758daa70ea87f4d698a4dac3c42fe"><div class="category-post-list"><a href="/DB-Project" title="DB课程项目-校园食堂点餐系统-开发文档" class="list-group-item list-group-item-action active"><span class="category-post">DB课程项目-校园食堂点餐系统-开发文档</span> </a><a href="/IR-Project" title="IR课程项目-文学检索-开发文档" class="list-group-item list-group-item-action"><span class="category-post">IR课程项目-文学检索-开发文档</span></a></div></div></div></div></aside></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 style="display:none">DB课程项目-校园食堂点餐系统-开发文档</h1><p class="note note-info">本文最后更新于：2022年5月19日 中午</p><div class="markdown-body"><p><img src="/img/blog/DB-Project-images/logo.png" srcset="/img/loading.gif" lazyload alt="logo"></p><p><code>Date</code>：2021-11</p><p><code>Description</code>：本文档作为 2021 年秋季学期「数据库系统」课程 Project 校园食堂点餐系统的开发文档，基于 MySQL+Django 实现。</p><p><code>Reference</code>：参考了一系列 Django 入门教程，在文中相应部分有链接。</p><p><code>Code Repo</code>：<a target="_blank" rel="noopener" href="https://github.com/hewei2001/campus-canteen-ordering">https://github.com/hewei2001/campus-canteen-ordering</a></p><p><code>Acknowledgement</code>：感谢 <a target="_blank" rel="noopener" href="https://github.com/Yiwen-Ding">Yiwen-Ding</a> 小盆友 😭 不然不可能肝完这么多内容。</p><p><code>Copyright</code>：© 2021 Hwcoder. All rights reserved.</p><h2 id="项目说明"><a href="#项目说明" class="headerlink" title="项目说明"></a>项目说明</h2><p>本实验要求设计并实现一个小型数据库应用系统，实现<strong>前后台</strong>数据交互，并将<strong>数据保存</strong>在之前实验所设计的数据库中。</p><p>由于不限语言和实现方式，同学们可能采用的方案大致有：Cpp+Qt，Python+Flask，Python+Django，Python+PyQt 等，还有其他 Java、PHP 一些我不太熟悉的方案。</p><p>本项目采用的是 Python+Django，是因为 Django 具有功能强大的脚手架和诸多开箱即用的组件，用 Django 搭建 Web 应用<strong>快速而又省力</strong>。相比于其他同学手敲 Qt 窗口，Django 自带的 Admin 已经基本把这些功能都实现了，甚至装了插件后还<strong>更美观</strong>，因此可以聚焦于前台交互的快速开发。</p><h3 id="项目背景"><a href="#项目背景" class="headerlink" title="项目背景"></a>项目背景</h3><p>本项目是建立在之前的实验结果的基础（已经用 PowerDesigner 设计并导出了数据库到 MySQL Workbench）上，再用 Django 进行应用系统的开发的过程。</p><p>这里简单描述一下之前的实验：</p><ul><li>设计校园食堂点餐系统，要求具备功能：食堂管理、商户管理、菜品管理、订单管理、用户管理；</li><li>E-R 图至少包括 8 个实体和 7 个联系；</li><li>需要考虑关系完整性约束：主键约束、外键约束、空值约束；</li><li>设计至少 1 个视图、1 个索引、1 个触发器（在应用中不需要体现）。</li></ul><p>以及设计好的 PDM (物理数据模型)：</p><p><img src="/img/blog/DB-Project-images/PDM.png" srcset="/img/loading.gif" lazyload alt="PDM" width="50%"></p><p>最终实现的功能：</p><p><img src="/img/blog/DB-Project-images/user.png" srcset="/img/loading.gif" lazyload alt="user"></p><p><img src="/img/blog/DB-Project-images/admin.png" srcset="/img/loading.gif" lazyload alt="admin"></p><h3 id="Django-基础"><a href="#Django-基础" class="headerlink" title="Django 基础"></a>Django 基础</h3><p>如果你之前从未接触过 Web 框架，可以先看这一篇文章：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/98788776">一杯茶的时间，上手 Django 框架开发</a>，再往下阅读。</p><p>通过这篇文章，你可以了解到：</p><ol><li>Django 环境的安装、项目初始化</li><li>项目的骨架以及各个文件的作用</li><li>Django App 的创建、各个子文件的作用</li><li>App 中 <code>views.py</code> 的编写、路由 <code>urls.py</code> 的使用</li><li>Django Template 的实现——模板生成的 HTML 文件将随数据变化</li><li>Django ORM 与数据库中的内容交互、迁移数据模型 <code>models.py</code></li><li>Django Admin 实现应用与后台管理接口、使用超级用户登录后台</li></ol><h2 id="设计文档"><a href="#设计文档" class="headerlink" title="设计文档"></a>设计文档</h2><h3 id="运行环境"><a href="#运行环境" class="headerlink" title="运行环境"></a>运行环境</h3><p>操作系统：</p><ul><li>Windows 10</li></ul><p>开发工具：</p><ul><li><p>IDE：PyCharm Community Edition 2020.2</p></li><li><p>设计：PowerDesigner</p></li><li><p>数据库：MySQL Workbench 8.0 CE</p></li></ul><p>主要技术：</p><ul><li><p>环境：Django 3.8</p></li><li><p>前端样式：Bootstrap</p></li><li><p>后台样式：Django-SimpleUI</p></li></ul><h3 id="Django-后台开发"><a href="#Django-后台开发" class="headerlink" title="Django 后台开发"></a>Django 后台开发</h3><p>本部分参考资料有：</p><ul><li><p><a target="_blank" rel="noopener" href="http://c.biancheng.net/django/">http://c.biancheng.net/django/</a></p></li><li><p><a target="_blank" rel="noopener" href="https://www.liujiangblog.com/course/django/">https://www.liujiangblog.com/course/django/</a></p></li></ul><h4 id="新建项目"><a href="#新建项目" class="headerlink" title="新建项目"></a>新建项目</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ django-admin startproject django_CCOS<br></code></pre></td></tr></table></figure><p>调整基础配置 <code>settings.py</code>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">LANGUAGE_CODE = <span class="hljs-string">&#x27;zh-Hans&#x27;</span><br>TIME_ZONE = <span class="hljs-string">&#x27;Asia/Shanghai&#x27;</span><br></code></pre></td></tr></table></figure><p>其他字段的意义可以参考：<a target="_blank" rel="noopener" href="http://c.biancheng.net/view/7475.html">http://c.biancheng.net/view/7475.html</a></p><p>为了存放图片等资源，需要在 <code>settings.py</code> 中加上以下内容，：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><br><span class="hljs-comment"># 这个是设置静态文件夹目录的路径</span><br>STATICFILES_DIRS = (<br>    os.path.join(BASE_DIR, <span class="hljs-string">&#x27;static&#x27;</span>),<br>)<br><span class="hljs-comment"># 设置文件上传路径，图片上传、文件上传都会存放在此目录里</span><br>MEDIA_URL = <span class="hljs-string">&#x27;/media/&#x27;</span><br>MEDIA_ROOT = os.path.join(BASE_DIR, <span class="hljs-string">&#x27;media&#x27;</span>)<br></code></pre></td></tr></table></figure><p>同时，在 <code>TEMPLATES</code> 中加上如下字段：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-string">&#x27;django.template.context_processors.media&#x27;</span>,<br></code></pre></td></tr></table></figure><p>Python3 的 Django 默认的数据库类型是 sqlite，由于之前的实验做的数据库是 MySQL 的，这里进行修改 <code>settings.py</code>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python">DATABASES = &#123;<br>    <span class="hljs-string">&#x27;default&#x27;</span>: &#123;<br>        <span class="hljs-string">&#x27;ENGINE&#x27;</span>: <span class="hljs-string">&#x27;django.db.backends.mysql&#x27;</span>,<br>        <span class="hljs-string">&#x27;NAME&#x27;</span>: <span class="hljs-string">&#x27;django_CCOS&#x27;</span>,  <span class="hljs-comment"># 连接的数据库</span><br>        <span class="hljs-string">&#x27;HOST&#x27;</span>: <span class="hljs-string">&#x27;127.0.0.1&#x27;</span>,    <span class="hljs-comment"># mysql的ip地址</span><br>        <span class="hljs-string">&#x27;PORT&#x27;</span>: <span class="hljs-number">3306</span>,           <span class="hljs-comment"># mysql的端口</span><br>        <span class="hljs-string">&#x27;USER&#x27;</span>: <span class="hljs-string">&#x27;root&#x27;</span>,         <span class="hljs-comment"># mysql的用户名</span><br>        <span class="hljs-string">&#x27;PASSWORD&#x27;</span>: <span class="hljs-string">&#x27;123456&#x27;</span>    <span class="hljs-comment"># mysql的密码</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>同时还要安装第三方库，并在 <code>__init__.py</code> 中加上：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pymysql<br><br>pymysql.install_as_MySQLdb()<br></code></pre></td></tr></table></figure><h4 id="连接-MySQL-数据库"><a href="#连接-MySQL-数据库" class="headerlink" title="连接 MySQL 数据库"></a>连接 MySQL 数据库</h4><p>打开 MySQL Workbench，创建新数据库，<code>create database CCOS</code>。将 Powerdesigner 生成的 <code>crebas.sql</code> 打开并执行，注意要注释掉 <code>drop</code> 等语句。此时我们的数据库就建好了。</p><p>打开项目，创建三个 App：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ python manage.py startapp canteen<br>$ python manage.py startapp customer<br>$ python manage.py startapp dish<br></code></pre></td></tr></table></figure><p>然后在 <code>INSTALLED_APPS</code> 中加上对应字段，注意要按顺序，否则后面的指令都会报错。</p><p>接下来要反向导入我们的数据库，在 Django 中生成 Model，参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/diao1057/article/details/98472327">https://blog.csdn.net/diao1057/article/details/98472327</a>。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ python manage.py inspectdb --database default canteen shop shop_manager &gt; canteen/models.py<br>$ python manage.py inspectdb --database default customer address  &gt; customer/models.py<br>$ python manage.py inspectdb --database default dish orders comments &gt; dish/models.py<br></code></pre></td></tr></table></figure><p>导入后如果出现如下报错：</p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gauss">Python Django ValueError: source <span class="hljs-built_in">code</span> <span class="hljs-keyword">string</span> cannot contain <span class="hljs-built_in">null</span> bytes<br></code></pre></td></tr></table></figure><p>很可能是因为生成的 <code>models.py</code> 的编码方式默认被改为 UTF-16 了，需要修改回 UTF-8。</p><h4 id="模型重建"><a href="#模型重建" class="headerlink" title="模型重建"></a>模型重建</h4><p>生成的 Model 不完整，还不能直接运行，据说是因为 Powerdesigner 比较拉跨。因此需要在刚刚生成的 <code>models.py</code> 中修改 <code>class</code> 的内容，并导出到数据库里，覆盖掉原来 Powerdesigner 生成的数据库。<code>class</code> 各个字段的意义参考：<a target="_blank" rel="noopener" href="https://www.liujiangblog.com/course/django/95">https://www.liujiangblog.com/course/django/95</a>。</p><p>可以看到所有的属性在 <code>class</code> 中都有自己的 Field，并传入了详细的定义，下面给出一些常用字段：</p><ul><li><code>verbose_name</code>：显示名</li><li><code>choices</code>：多选框</li><li><code>upload_to</code>：图片上传路径</li><li><code>max_length</code>：最大长度</li><li><code>blank=True, null=True,</code>：可以为空</li></ul><blockquote><p>特别要注意外键属性（ForeignKey），如果外键在当前 App 内还好（跟定义顺序有关），要是在其他 App 里，则要 <code>from [其他app].models import xxx</code>。此外，外键还有一个 <code>on_delete</code> 属性，代表删除外键对本表记录的影响，参考：<a target="_blank" rel="noopener" href="https://www.liujiangblog.com/course/django/96">https://www.liujiangblog.com/course/django/96</a>。</p></blockquote><p>还有 <code>class Meta</code> 部分，可以设置对整体的操作，比如 ordering 显示顺序等。注意要把之前反向导入产生的 <code>managed = False</code> 字段删除。</p><p>在每一个 <code>class</code> 下加上 Python 的一个魔法方法，用于返回实例对象的打印字符串。：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__str__</span>(<span class="hljs-params">self</span>):</span><br>    <span class="hljs-keyword">return</span> self.title  <span class="hljs-comment"># title 换成想显示的属性</span><br></code></pre></td></tr></table></figure><p>最后的成品举例如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Dish</span>(<span class="hljs-params">models.Model</span>):</span><br>    dish_id = models.AutoField(primary_key=<span class="hljs-literal">True</span>, verbose_name=<span class="hljs-string">&#x27;菜品编号&#x27;</span>)<br>    shop = models.ForeignKey(<span class="hljs-string">&#x27;canteen.Shop&#x27;</span>, models.CASCADE, verbose_name=<span class="hljs-string">&#x27;窗口&#x27;</span>)<br>    dish_name = models.CharField(max_length=<span class="hljs-number">20</span>, verbose_name=<span class="hljs-string">&#x27;菜品名称&#x27;</span>)<br>    dish_detail = models.CharField(max_length=<span class="hljs-number">200</span>, blank=<span class="hljs-literal">True</span>, null=<span class="hljs-literal">True</span>, verbose_name=<span class="hljs-string">&#x27;菜品描述&#x27;</span>)<br>    dish_price = models.DecimalField(max_digits=<span class="hljs-number">5</span>, decimal_places=<span class="hljs-number">2</span>, verbose_name=<span class="hljs-string">&quot;菜品价格&quot;</span>)<br>    dish_photo = models.ImageField(upload_to=<span class="hljs-string">&#x27;image/dish&#x27;</span>, null=<span class="hljs-literal">True</span>, blank=<span class="hljs-literal">True</span>, verbose_name=<span class="hljs-string">&#x27;菜品照片&#x27;</span>)<br>    dish_active = models.IntegerField(choices = [(<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;销售中&#x27;</span>),(<span class="hljs-number">0</span>, <span class="hljs-string">&#x27;售罄&#x27;</span>)], verbose_name=<span class="hljs-string">&#x27;菜品状态&#x27;</span>)<br><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Meta</span>:</span><br>        ordering = [<span class="hljs-string">&#x27;dish_id&#x27;</span>]<br>        db_table = <span class="hljs-string">&#x27;dish&#x27;</span><br>        verbose_name = <span class="hljs-string">&quot;菜品信息&quot;</span><br>        verbose_name_plural = verbose_name<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__str__</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">return</span> self.dish_name<br></code></pre></td></tr></table></figure><h4 id="数据库迁移"><a href="#数据库迁移" class="headerlink" title="数据库迁移"></a>数据库迁移</h4><p>运行以下命令创建迁移文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ python manage.py makemigrations<br></code></pre></td></tr></table></figure><p>由于导出时会覆盖原来的 MySQL 里的数据库，会创造很多乱七八糟的表，可能会有些许报错，建议在 MySQL 重新创一个空数据库 <code>create database django_CCOS</code>，并修改 <code>settings.py</code> 中的连接。</p><p>接着我们进行数据库迁移：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ python manage.py migrate<br></code></pre></td></tr></table></figure><h4 id="后台接口管理"><a href="#后台接口管理" class="headerlink" title="后台接口管理"></a>后台接口管理</h4><p>数据库迁移完成后，我们就可以创建用于登录后台管理的超级用户：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ python manage.py createsuperuser<br></code></pre></td></tr></table></figure><p>按照提示填写用户名和密码即可。</p><p>在每个 App 下的 <code>admin.py</code> 添加后台管理接口如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> django.contrib <span class="hljs-keyword">import</span> admin<br><br><span class="hljs-keyword">from</span> .models <span class="hljs-keyword">import</span> Canteen, Shop, ShopManager<br><br>admin.site.register(Canteen)<br>admin.site.register(Shop)<br>admin.site.register(ShopManager)<br></code></pre></td></tr></table></figure><p>完成上述操作后，访问 <a href="localhost:8000/admin">localhost:8000/admin</a>，进入后台系统的登录页面，填入刚才设置的用户名和密码，进入后台管理页面。此时已经可以看到所有的表单，且可以完成基础的管理操作。</p><h3 id="BootStrap-前端开发"><a href="#BootStrap-前端开发" class="headerlink" title="BootStrap 前端开发"></a>BootStrap 前端开发</h3><p>完成了后台，现在来实现前端，这就需要用到 Django 的 templates 模板。首先在<strong>主目录</strong>下新建 <code>templates</code> 用于存放前端页面 html，再创建 <code>static</code> 用来存放渲染静态页面需要的 css 资源。</p><p>参考博客：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/qican/p/14626811.html">https://www.cnblogs.com/qican/p/14626811.html</a></p><h4 id="静态模板安装"><a href="#静态模板安装" class="headerlink" title="静态模板安装"></a>静态模板安装</h4><p>首先下载 Bootstrap：<a target="_blank" rel="noopener" href="https://v3.bootcss.com/getting-started/#download">https://v3.bootcss.com/getting-started/#download</a>，下载下来后放入 <code>static</code> 文件夹（也可以直接从别人的 Django 项目中复制进来，可能样式更高级）。</p><p>修改 <code>setting.py</code>，前面已经加了 <code>static</code> 内容，现在要在 <code>TEMPLATE</code> 字典中加入如下，用以表示模板路径：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-string">&#x27;DIRS&#x27;</span>: [BASE_DIR / <span class="hljs-string">&#x27;templates&#x27;</span>],<br></code></pre></td></tr></table></figure><h4 id="view-py"><a href="#view-py" class="headerlink" title="view.py"></a>view.py</h4><p>在 canteen 的 <code>view.py</code> 中写入如下内容，用以 render 数据：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> django.shortcuts <span class="hljs-keyword">import</span> render<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">index</span>(<span class="hljs-params">request</span>):</span><br>    <span class="hljs-keyword">return</span> render(request, <span class="hljs-string">&#x27;base.html&#x27;</span>)<br></code></pre></td></tr></table></figure><h4 id="HTML"><a href="#HTML" class="headerlink" title="HTML"></a>HTML</h4><p>在 <code>templates</code> 中放入我们的 <code>base.html</code>，作为展示的首页，内容如下：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><br>&#123;% load static %&#125;<br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span> <span class="hljs-attr">dir</span>=<span class="hljs-string">&quot;ltr&quot;</span>&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    	<span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;utf-8&quot;</span>&gt;</span><br>    	<span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>校园食堂点餐系统<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    	<span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;&#123;% static &#x27;css/master.css&#x27; %&#125;&quot;</span>&gt;</span><br>	<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- 此处省略首页代码，如导航栏等 --&gt;</span><br>	<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>其中静态资源引用了 <code>static</code> 下面的 <code>css/master.css</code>，来自 GitHub 的其他开源项目。</p><h4 id="URL-路径配置"><a href="#URL-路径配置" class="headerlink" title="URL 路径配置"></a>URL 路径配置</h4><p>修改 <code>urls.py</code>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 用于 include 其他模板所在的 url</span><br><span class="hljs-keyword">from</span> django.conf.urls <span class="hljs-keyword">import</span> url, include<br><br>urlpatterns = [<br>    path(<span class="hljs-string">&#x27;admin/&#x27;</span>, admin.site.urls),<br>    path(<span class="hljs-string">&#x27;&#x27;</span>, include(<span class="hljs-string">&#x27;canteen.urls&#x27;</span>)),<br>]<br></code></pre></td></tr></table></figure><p>由于加了 <code>canteen</code>，相应的也要在 <code>canteen/urls.py</code> 中加入：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> django.urls <span class="hljs-keyword">import</span> path<br><span class="hljs-keyword">from</span> .views <span class="hljs-keyword">import</span> index<br><br>app_name = <span class="hljs-string">&#x27;canteen&#x27;</span><br>urlpatterns = [<br>    path(<span class="hljs-string">&#x27;&#x27;</span>, index),<br>]<br></code></pre></td></tr></table></figure><p>之后就可以看到首页啦，其他功能将在下一节介绍。</p><h3 id="交互功能开发"><a href="#交互功能开发" class="headerlink" title="交互功能开发"></a>交互功能开发</h3><p>要求实现的功能：食堂管理、商户管理、菜品管理、订单管理、用户管理。</p><h4 id="用户登录注册"><a href="#用户登录注册" class="headerlink" title="用户登录注册"></a>用户登录注册</h4><p>参考资料：<a target="_blank" rel="noopener" href="https://www.liujiangblog.com/course/django/102">https://www.liujiangblog.com/course/django/102</a></p><p>在 <code>customer</code> 下 <code>view.py</code> 中加入用户登录的方法，其中 <code>locals()</code> 代表返回当前方法里的全部变量：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> django.shortcuts <span class="hljs-keyword">import</span> render<br><span class="hljs-keyword">from</span> .forms <span class="hljs-keyword">import</span> LoginForm, RegisterForm <span class="hljs-comment"># 导入表单，下面将介绍</span><br><span class="hljs-keyword">from</span> django.contrib <span class="hljs-keyword">import</span> messages<br><span class="hljs-keyword">from</span> .models <span class="hljs-keyword">import</span> Customer<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">register</span>(<span class="hljs-params">request</span>):</span><br>    <span class="hljs-comment"># 写注册方法</span><br>    <span class="hljs-keyword">return</span> render(request, <span class="hljs-string">&#x27;customer/register.html&#x27;</span>, <span class="hljs-built_in">locals</span>())<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">login</span>(<span class="hljs-params">request</span>):</span><br>    <span class="hljs-comment"># 写登录方法</span><br>    <span class="hljs-keyword">return</span> render(request, <span class="hljs-string">&#x27;customer/login.html&#x27;</span>, <span class="hljs-built_in">locals</span>())<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">logout</span>(<span class="hljs-params">request</span>):</span><br>    <span class="hljs-comment"># 写登出方法</span><br>    <span class="hljs-keyword">return</span> render(request, <span class="hljs-string">&#x27;customer/index.html&#x27;</span>, <span class="hljs-built_in">locals</span>())<br></code></pre></td></tr></table></figure><p>具体访问策略如下：</p><ul><li>未登录人员，不论是访问 index 还是 login 和 logout，全部跳转到 login 界面</li><li>已登录人员，访问 login 会自动跳转到 index 页面</li><li>已登录人员，不允许直接访问 register 页面，需先 logout</li><li>登出后，自动跳转到 login 界面</li></ul><p>于是，在主目录 <code>urls.py</code> 中加入：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">path(<span class="hljs-string">&#x27;customer/&#x27;</span>, include(<span class="hljs-string">&#x27;customer.urls&#x27;</span>)),<br></code></pre></td></tr></table></figure><p>在 <code>customer/urls.py</code> 中加入：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> django.urls <span class="hljs-keyword">import</span> path<br><span class="hljs-keyword">from</span> .views <span class="hljs-keyword">import</span> index, login, register, logout<br><br>app_name = <span class="hljs-string">&#x27;customer&#x27;</span><br>urlpatterns = [<br>    path(<span class="hljs-string">&#x27;&#x27;</span>, index),<br>    path(<span class="hljs-string">&#x27;login/&#x27;</span>, login),<br>    path(<span class="hljs-string">&#x27;register/&#x27;</span>, register),<br>    path(<span class="hljs-string">&#x27;logout/&#x27;</span>, logout),<br>]<br></code></pre></td></tr></table></figure><p>实现登录时，需要用到表单 form，创建 <code>cutomser/forms.py</code>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> django <span class="hljs-keyword">import</span> forms<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LoginForm</span>(<span class="hljs-params">forms.Form</span>):</span><br>    username = forms.CharField(label=<span class="hljs-string">&quot;用户名&quot;</span>, max_length=<span class="hljs-number">128</span>, widget=forms.TextInput(attrs=&#123;<span class="hljs-string">&#x27;class&#x27;</span>: <span class="hljs-string">&#x27;form-control&#x27;</span>, <span class="hljs-string">&#x27;placeholder&#x27;</span>: <span class="hljs-string">&quot;Username&quot;</span>,<span class="hljs-string">&#x27;autofocus&#x27;</span>: <span class="hljs-string">&#x27;&#x27;</span>&#125;),<br>                    error_messages=&#123;<span class="hljs-string">&#x27;required&#x27;</span>: <span class="hljs-string">&#x27;用户名不能为空&#x27;</span>,<span class="hljs-string">&#x27;min_length&#x27;</span>: <span class="hljs-string">&#x27;用户名最少为3个字符&#x27;</span>,<br>   <span class="hljs-string">&#x27;max_length&#x27;</span>: <span class="hljs-string">&#x27;用户名最不超过为20个字符&#x27;</span>&#125;,)<br>    password = forms.CharField(label=<span class="hljs-string">&quot;密码&quot;</span>, max_length=<span class="hljs-number">256</span>, widget=forms.PasswordInput(attrs=&#123;<span class="hljs-string">&#x27;class&#x27;</span>: <span class="hljs-string">&#x27;form-control&#x27;</span>,<span class="hljs-string">&#x27;placeholder&#x27;</span>: <span class="hljs-string">&quot;Password&quot;</span>&#125;))<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RegisterForm</span>(<span class="hljs-params">forms.Form</span>):</span><br>    username = forms.CharField(label=<span class="hljs-string">&quot;用户名&quot;</span>, max_length=<span class="hljs-number">128</span>, widget=forms.TextInput(attrs=&#123;<span class="hljs-string">&#x27;class&#x27;</span>: <span class="hljs-string">&#x27;form-control&#x27;</span>, <span class="hljs-string">&#x27;placeholder&#x27;</span>: <span class="hljs-string">&quot;Username&quot;</span>,<span class="hljs-string">&#x27;autofocus&#x27;</span>: <span class="hljs-string">&#x27;&#x27;</span>&#125;))<br>    password1 = forms.CharField(label=<span class="hljs-string">&quot;密码&quot;</span>, max_length=<span class="hljs-number">256</span>, widget=forms.PasswordInput(attrs=&#123;<span class="hljs-string">&#x27;class&#x27;</span>: <span class="hljs-string">&#x27;form-control&#x27;</span>,<span class="hljs-string">&#x27;placeholder&#x27;</span>: <span class="hljs-string">&quot;Password&quot;</span>&#125;))<br>    password2 = forms.CharField(label=<span class="hljs-string">&quot;确认密码&quot;</span>, max_length=<span class="hljs-number">256</span>, widget=forms.PasswordInput(attrs=&#123;<span class="hljs-string">&#x27;class&#x27;</span>: <span class="hljs-string">&#x27;form-control&#x27;</span>,<span class="hljs-string">&#x27;placeholder&#x27;</span>: <span class="hljs-string">&quot;Password&quot;</span>&#125;))<br>    tel = forms.CharField(label=<span class="hljs-string">&quot;电话&quot;</span>, widget=forms.TextInput(attrs=&#123;<span class="hljs-string">&#x27;class&#x27;</span>: <span class="hljs-string">&#x27;form-control&#x27;</span>, <span class="hljs-string">&#x27;placeholder&#x27;</span>: <span class="hljs-string">&quot;TEL&quot;</span>&#125;))<br></code></pre></td></tr></table></figure><p>其他诸如 session(会话) 的内容默认已经配置好了（session 是用于保存当前在线用户信息的，用于各种与用户关联的查询），现在可以打开页面查看登录。</p><h4 id="食堂、窗口、菜品展示"><a href="#食堂、窗口、菜品展示" class="headerlink" title="食堂、窗口、菜品展示"></a>食堂、窗口、菜品展示</h4><p>在相应的 views.py 中写好 ORM 方法，将数据库内的表元组全部传到 Django，再到 templates 中写好 html，将传出的元组以循环遍历显示。</p><p>例如显示食堂和窗口，在 <code>canteen/views.py</code> 写入：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> django.shortcuts <span class="hljs-keyword">import</span> render<br><span class="hljs-keyword">from</span> .models <span class="hljs-keyword">import</span> Canteen, Shop<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show_canteen</span>(<span class="hljs-params">request</span>):</span><br>    template_name = <span class="hljs-string">&#x27;canteen/canteen_list.html&#x27;</span><br>    context = &#123;<span class="hljs-string">&#x27;canteen_list&#x27;</span>: Canteen.objects.<span class="hljs-built_in">all</span>()&#125;<br>    <span class="hljs-keyword">return</span> render(request, template_name, context)<br></code></pre></td></tr></table></figure><p>再到 canteen_list.html 中写下：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs html">&#123;% block store_content %&#125;<br><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;container&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;row&quot;</span>&gt;</span><br>            &#123;% for i in canteen_list %&#125;<br>            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;align-items-stretch&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;card cardmodify cardbackground&quot;</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;card-header&quot;</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">h5</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">b</span>&gt;</span>&#123;&#123; i.canteen_name &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h5</span>&gt;</span><br>                    	<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;card-img-top&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;&#123;&#123; i.canteen_photo.url &#125;&#125;&quot;</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">h5</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">b</span>&gt;</span>&#123;&#123; i.canteen_active &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h5</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">h5</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">b</span>&gt;</span>卫生等级：&#123;&#123; i.sanitation_level &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h5</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>            &#123;% endfor %&#125;<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>&#123;% endblock %&#125;<br></code></pre></td></tr></table></figure><p>再修改相应的路由，就能在页面中以卡片的形式展示食堂了！样式代码来自 GitHub 的其他开源项目。</p><p>然而，这样只能实现所有食堂、所有窗口、所有菜品在一个静态页面中的显示，无法根据用户选中某个食堂而显示其对应的窗口。于是，本项目中采用了一个取巧的方法，利用 HTML 的锚定位和 <code>id</code> 属性，选中某个食堂跳转到窗口页的相应 <code>id</code> 处，让用户「看似」进入了该食堂独立的页面。</p><h4 id="用户下单"><a href="#用户下单" class="headerlink" title="用户下单"></a>用户下单</h4><p>这里用到了 <code>reverse</code> 方法，也是全项目卡住最久的地方，需要在 Model 中定义如下内容：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_order_url</span>(<span class="hljs-params">self</span>):</span><br>    <span class="hljs-keyword">return</span> reverse(<span class="hljs-string">&quot;dish:get_order&quot;</span>, kwargs=&#123;<span class="hljs-string">&#x27;dish_id&#x27;</span>: self.dish_id&#125;)<br></code></pre></td></tr></table></figure><p>这意味着当用户点击按钮时，触发 <code>get_order_url</code> 方法，该方法将传入的 <code>dish_id</code> 转发到 <code>dish/views.py</code> 中的 <code>get_order</code> 方法，再进行处理：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_order</span>(<span class="hljs-params">request, dish_id</span>):</span><br>    dish = get_object_or_404(Dish, dish_id=dish_id)<br>    user_id = request.session[<span class="hljs-string">&#x27;user_id&#x27;</span>]<br><br>    <span class="hljs-keyword">try</span>:<br>        user = Customer.objects.<span class="hljs-built_in">filter</span>(customer_id=user_id).first()<br>        order = Orders.objects.create(dish=dish, customer=user)<br>        order.order_price = order.dish.dish_price<br>        order.order_status = <span class="hljs-number">0</span><br>        order.save()<br>        messages.success(request, <span class="hljs-string">&#x27;下单成功！&#x27;</span>)<br>        <span class="hljs-keyword">return</span> redirect(<span class="hljs-string">&quot;dish:show_order&quot;</span>)<br><br>    <span class="hljs-keyword">except</span> ObjectDoesNotExist:<br>        messages.warning(request, <span class="hljs-string">&quot;你还没有订单哦~&quot;</span>)<br>        <span class="hljs-keyword">return</span> redirect(<span class="hljs-string">&quot;dish:show_order&quot;</span>)<br></code></pre></td></tr></table></figure><p>相应的按钮触发事件还需要在 HTML 标签中指出，这里不再赘述。</p><h4 id="其他页面"><a href="#其他页面" class="headerlink" title="其他页面"></a>其他页面</h4><p>诸如订单页面、个人中心页面等，实现方法都是用 ORM 筛选数据库中当前用户的数据，并用模板显示出来。需要注意的是，进入该界面前要先判断，如果未登录则重定向至登录界面：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> request.session.get(<span class="hljs-string">&#x27;is_login&#x27;</span>, <span class="hljs-literal">None</span>):<br>    messages.warning(request, <span class="hljs-string">&quot;请先登录顾客账户~&quot;</span>)<br>    <span class="hljs-keyword">return</span> redirect(<span class="hljs-string">&#x27;/customer/login/&#x27;</span>)<br></code></pre></td></tr></table></figure><h4 id="优化后台管理"><a href="#优化后台管理" class="headerlink" title="优化后台管理"></a>优化后台管理</h4><p>在 <code>admin.py</code> 里修改显示内容，使后台展示更全面。例如：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DishAdmin</span>(<span class="hljs-params">admin.ModelAdmin</span>):</span><br>    list_per_page = <span class="hljs-number">10</span><br>    search_fields = [<span class="hljs-string">&#x27;dish_name&#x27;</span>]<br>    list_display = [<span class="hljs-string">&#x27;dish_id&#x27;</span>, <span class="hljs-string">&#x27;dish_name&#x27;</span>, <span class="hljs-string">&#x27;shop&#x27;</span>, <span class="hljs-string">&#x27;dish_price&#x27;</span>, <span class="hljs-string">&#x27;dish_active&#x27;</span>]<br></code></pre></td></tr></table></figure><p>就可以在后台显示详细信息，并加入搜索框，可以根据菜品名搜索。</p><p>此外，开源资源中还有许多对 Django Admin 的 UI 优化插件，例如 simpleui，只需在 app 中包含即可。</p><h2 id="页面展示"><a href="#页面展示" class="headerlink" title="页面展示"></a>页面展示</h2><p><img src="/img/blog/DB-Project-images/page1.png" srcset="/img/loading.gif" lazyload alt="菜品展示界面"></p><p><img src="/img/blog/DB-Project-images/page2.png" srcset="/img/loading.gif" lazyload alt="用户登录界面"></p><p><img src="/img/blog/DB-Project-images/page3.png" srcset="/img/loading.gif" lazyload alt="订单展示界面"></p><p><img src="/img/blog/DB-Project-images/page4.png" srcset="/img/loading.gif" lazyload alt="后台管理界面"></p><p><img src="/img/blog/DB-Project-images/page5.png" srcset="/img/loading.gif" lazyload alt="后台操作演示"></p></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/%E9%A1%B9%E7%9B%AE%E7%BB%8F%E5%8E%86/" class="category-chain-item">项目经历</a></span></span></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/tags/Database/">#Database</a></div></div><div class="license-box my-3"><div class="license-title"><div>DB课程项目-校园食堂点餐系统-开发文档</div><div>https://hwcoder.top/DB-Project</div></div><div class="license-meta"><div class="license-meta-item"><div>作者</div><div>He Wei</div></div><div class="license-meta-item license-meta-date"><div>发布于</div><div>2021年11月21日</div></div><div class="license-meta-item"><div>许可协议</div><div><a target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><span class="hint--top hint--rounded" aria-label="BY - 署名"><i class="iconfont icon-by"></i> </span></a><a target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><span class="hint--top hint--rounded" aria-label="NC - 非商业性使用"><i class="iconfont icon-nc"></i> </span></a><a target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><span class="hint--top hint--rounded" aria-label="SA - 相同方式共享"><i class="iconfont icon-sa"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/Everyone-Has-A-Time-Zone" title="Everyone Has Their Own Time Zone"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">Everyone Has Their Own Time Zone</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/Database-System" title="数据库系统 应试笔记"><span class="hidden-mobile">数据库系统 应试笔记</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article id="comments" lazyload><div id="valine"></div><script type="text/javascript">Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/valine/1.4.16/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"jdbBr3BddTiqSCPnXw6sXFv7-gzGzoHsz","appKey":"2bjgwDr2opjVCwhgjDMpk53c","path":"window.location.pathname","placeholder":"说点什么吧( •̀ ω •́ )✧","avatar":"retro","meta":["nick","mail","link"],"requiredFields":["nick"],"pageSize":10,"lang":"zh-CN","highlight":true,"recordIP":true,"serverURLs":"","emojiCDN":null,"emojiMaps":null,"enableQQ":false},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          var imgSelector = '#valine .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });</script><noscript>Please enable JavaScript to view the comments</noscript></article></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a></div><div class="statistics"><span id="leancloud-site-pv-container" style="display:none">总访问量 <span id="leancloud-site-pv"></span> 次 </span><span id="leancloud-site-uv-container" style="display:none">总访客数 <span id="leancloud-site-uv"></span> 人</span></div></div></footer><script src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",function(){NProgress.done()})</script><script src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js"></script><script src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js"></script><script>!function(t){var e=Fluid.plugins.typing,i=t.getElementById("subtitle");i&&e&&e(i.getAttribute("data-typed-text"))}((window,document))</script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.18.0/tocbot.min.js",function(){var t,o=jQuery("#toc");0!==o.length&&window.tocbot&&(t=jQuery("#board-ctn").offset().top,window.tocbot.init({tocSelector:"#toc-body",contentSelector:".markdown-body",headingSelector:CONFIG.toc.headingSelector||"h1,h2,h3,h4,h5,h6",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",collapseDepth:CONFIG.toc.collapseDepth||0,scrollSmooth:!0,headingsOffset:-t}),0<o.find(".toc-list-item").length&&o.css("visibility","visible"))})</script><script>!function(){var i,t=CONFIG.code_language.enable&&CONFIG.code_language.default,c=CONFIG.copy_btn;(t||c)&&(i="",i+='<div class="code-widget">',i+="LANG",i+="</div>",jQuery(".markdown-body pre").each(function(){var e,a,n=jQuery(this);0<n.find("code.mermaid").length||0<n.find("span.line").length||(e="",t&&(e=CONFIG.code_language.default,0<n[0].children.length&&2<=n[0].children[0].classList.length&&n.children().hasClass("hljs")?e=n[0].children[0].classList[1]:n[0].getAttribute("data-language")?e=n[0].getAttribute("data-language"):n.parent().hasClass("sourceCode")&&0<n[0].children.length&&2<=n[0].children[0].classList.length?(e=n[0].children[0].classList[1],n.parent().addClass("code-wrapper")):n.parent().hasClass("markdown-body")&&0===n[0].classList.length&&n.wrap('<div class="code-wrapper"></div>'),e=e.toUpperCase().replace("NONE",CONFIG.code_language.default)),n.append(i.replace("LANG",e).replace('code-widget">',(a=n[0],(0<=Fluid.utils.getBackgroundLightness(a)?"code-widget-light":"code-widget-dark")+(c?' code-widget copy-btn" data-clipboard-snippet><i class="iconfont icon-copy"></i>':' code-widget">')))),c&&Fluid.utils.createScript("https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js",function(){new window.ClipboardJS(".copy-btn",{target:function(e){for(var a=e.parentNode.childNodes,n=0;n<a.length;n++)if("CODE"===a[n].tagName)return a[n]}}).on("success",function(e){e.clearSelection(),e.trigger.innerHTML=e.trigger.innerHTML.replace("icon-copy","icon-success"),setTimeout(function(){e.trigger.innerHTML=e.trigger.innerHTML.replace("icon-success","icon-copy")},2e3)})}))}))}()</script><script>Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));
  });</script><script>Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",function(){Fluid.plugins.fancyBox()})</script><script>Fluid.plugins.imageCaption()</script><script src="/js/local-search.js"></script><script defer src="/js/leancloud.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div></noscript></body></html>