<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/logo.jpg"><link rel="icon" href="/img/logo.jpg"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"><meta name="theme-color" content="#01213a"><meta name="description" content="学习 Linux 时做的笔记，本文记录了初次连接服务器后，配置 Anaconda 深度学习环境的过程，以及 Git、Zsh、反向代理等个人配置，文末附上一键配置环境脚本。"><meta name="author" content="He Wei"><meta name="keywords" content="Computer Science and Technology, Machine Learning, Deep Learning, Computer Vision, Natural Language Processing"><meta name="baidu-site-verification" content="code-J3wrn8WJYJ"><meta name="google-site-verification" content="0p_KJKTfB8EcahVDp0vYRjVRhHFw1SBWHi15OakKHY0"><meta name="description" content="学习 Linux 时做的笔记，本文记录了初次连接服务器后，配置 Anaconda 深度学习环境的过程，以及 Git、Zsh、反向代理等个人配置，文末附上一键配置环境脚本。"><meta property="og:type" content="article"><meta property="og:title" content="Linux学习笔记 #4 服务器环境配置"><meta property="og:url" content="https://hwcoder.top/Linux-Note-4"><meta property="og:site_name" content="Hwcoder - Life Oriented Programming"><meta property="og:description" content="学习 Linux 时做的笔记，本文记录了初次连接服务器后，配置 Anaconda 深度学习环境的过程，以及 Git、Zsh、反向代理等个人配置，文末附上一键配置环境脚本。"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2022-03-04T16:31:57.000Z"><meta property="article:modified_time" content="2022-04-20T13:00:37.692Z"><meta property="article:author" content="He Wei"><meta property="article:tag" content="Linux"><meta name="twitter:card" content="summary_large_image"><title>Linux学习笔记 #4 服务器环境配置 | Hwcoder - Life Oriented Programming</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css"><link rel="stylesheet" href="/lib/hint/hint.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10/styles/night-owl.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/css/mac.css"><script id="fluid-configs">var Fluid=window.Fluid||{},CONFIG={hostname:"hwcoder.top",root:"/",version:"1.8.12",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1},anchorjs:{enable:!0,element:"h2, h3",placement:"left",visible:"always",icon:"§"},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},copy_btn:!0,image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,headingSelector:"h1,h2,h3,h4",collapseDepth:3},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!0,baidu:null,google:null,gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:"XGNf4GEnaFLiUijMUvz8HSBF-gzGzoHsz",app_key:"JPeVLcug6EcWdBTpGrDJSdKi",server_url:"https://xgnf4gen.lc-cn-n1-shared.com",path:"window.location.pathname"}},search_path:"/local-search.xml"}</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><meta name="generator" content="Hexo 5.4.0"></head><body><header style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>Hwcoder</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> 首页</a></li><li class="nav-item"><a class="nav-link" href="/archives/"><i class="iconfont icon-archive-fill"></i> 归档</a></li><li class="nav-item"><a class="nav-link" href="/categories/"><i class="iconfont icon-category-fill"></i> 分类</a></li><li class="nav-item"><a class="nav-link" href="/tags/"><i class="iconfont icon-tags-fill"></i> 标签</a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> 关于我</a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">&nbsp;<i class="iconfont icon-search"></i>&nbsp;</a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a></li></ul></div></div></nav><div class="banner" id="banner" parallax="true" style="background:url(/img/bg/other.jpg) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="page-header text-center fade-in-up"><span class="h2" id="subtitle" title="Linux学习笔记 #4 服务器环境配置"></span><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2022-03-05 00:31" pubdate>2022年3月5日 凌晨</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 7.8k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 33 分钟 </span><span id="leancloud-page-views-container" class="post-meta" style="display:none"><i class="iconfont icon-eye" aria-hidden="true"></i> <span id="leancloud-page-views"></span> 次</span></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div class="py-5" id="board"><article class="post-content mx-auto"><h1 style="display:none">Linux学习笔记 #4 服务器环境配置</h1><p class="note note-info">本文最后更新于：2022年4月20日 晚上</p><div class="markdown-body"><p>上一节 <a href="https://hwcoder.top/Linux-Note-3">Linux学习笔记 #3 连接远程服务器</a> 中，介绍了远程控制 Linux 服务器的情景。假设我们已经完成了初次 SSH 鉴权，以下内容为<strong>后续</strong>的操作。</p><p>当新用户登录服务器时，会默认在 <code>/home/user</code> 目录下，此时这里只有配置好的 <code>.ssh</code> 目录。用户目录下的所有配置<strong>仅会与用户个人绑定</strong>，包括 Python、Conda、Git、Bash 等环境，所以此时我们需要一一配置。</p><blockquote><p><code>/home/user</code> 目录通常空间有限，因此对于<strong>开放权限较高</strong>的私人服务器，用户目录只用于存放个人使用的配置文件。而工程以及大文件则会存放在另外的 <code>/data/user</code> 目录下，以节省服务器的存储空间。下面我们称 <code>/home/user</code> 目录为 <code>~</code>。</p></blockquote><h2 id="Anaconda-环境"><a href="#Anaconda-环境" class="headerlink" title="Anaconda 环境"></a>Anaconda 环境</h2><p>首先需要安装 Anaconda 环境，使用 <code>wget</code> 命令从清华镜像源下载（该命令由 Unix 自带），不需要下载最新版（这里选用的版本仅支持到 Py3.8）：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs Shell"><span class="hljs-meta">$</span><span class="bash"> wget https://mirrors.tuna.tsinghua.edu.cn/anaconda/archive/Anaconda3-2020.02-Linux-x86_64.sh</span><br></code></pre></div></td></tr></table></figure><p>下载完成后，当前目录下就会出现 <code>.sh</code> 脚本形式的安装包，输入以下命令运行：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs Shell"><span class="hljs-meta">$</span><span class="bash"> bash ./Anaconda3-2020.02-Linux-x86_64.sh</span><br></code></pre></div></td></tr></table></figure><p>一路 Enter 确定，最后输入 yes，安装后可用 <code>conda -V</code> 查看版本。如果这里提示无法识别命令，参考接下来的做法即可。</p><h3 id="虚拟环境"><a href="#虚拟环境" class="headerlink" title="虚拟环境"></a>虚拟环境</h3><p>在 <code>~</code> 目录下，还有一个 <code>.bashrc</code> 文件，对于大部分 Unix 系统，Bash 是作为默认终端被安装的。你对 bashrc 所做的任何修改将在<strong>下一次启动终端</strong>时生效。如果你想立刻生效的话，运行下面的命令：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs Shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">source</span> ~/.bashrc</span><br></code></pre></div></td></tr></table></figure><p>此时会发现用户名前面就会有一个 <code>(base)</code>，表示现在处于<strong>基础环境</strong>中。Conda 集成了 Python 发行版，同时可以对 Python 虚拟环境进行管理，常用的命令有：</p><ul><li><code>conda create -n &lt;环境名&gt; python=&lt;版本&gt;</code>：创建 conda 环境。</li><li><code>conda create -n &lt;环境名&gt; --file &lt;this file&gt;</code>：创建 conda 环境并指定 requirement.txt 路径配置。</li><li><code>conda create -n &lt;新环境名&gt; --clone &lt;旧环境名&gt;</code>：复制原有 conda 环境。</li><li><code>conda env list</code> 或 <code>conda info -e</code>：查看现有的 conda 环境。</li><li><code>conda activate &lt;环境名&gt;</code>：切换 conda 环境。</li><li><code>conda deactivate</code>：关闭虚拟环境。</li><li><code>conda remove -n &lt;环境名&gt;</code>：删除环境。</li></ul><p>良好的环境管理习惯有益于在同一机器上运行多个深度学习框架而相互之间不会影响，用户创建的环境会被保存在 <code>~/anaconda3/env/xxx</code>，需要时可以直接拷贝。</p><h3 id="CUDA-环境与-PyTorch"><a href="#CUDA-环境与-PyTorch" class="headerlink" title="CUDA 环境与 PyTorch"></a>CUDA 环境与 PyTorch</h3><p>安装完 Anaconda 后，我们就能使用 <code>pip</code> 和 <code>conda</code> 两种包管理器了（此前只能用 Linux 自带的 <code>apt</code>）。</p><blockquote><p>在服务器里，我们只推荐用 <code>conda</code> 安装 <code>cudatoolkit</code>、<code>cudnn</code> 以及 <code>jupyter</code> 相关的包，其他包建议用 <code>pip</code> 进行安装。</p></blockquote><p>这里建议使用 11.1 版本的 CUDA 环境，使用 <code>conda</code> 在 <code>conda-forge</code> 源下进行安装：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs Shell"><span class="hljs-meta">$</span><span class="bash"> conda install -c conda-forge cudatoolkit=11.1 cudnn</span> <br></code></pre></div></td></tr></table></figure><p>安装在<strong>基本环境</strong>后，可以使用 <code>nvcc -V</code> 查看 CUDA 版本。</p><blockquote><p>有的服务器不装 CUDA 也能使用 GPU，是因为 Nvidia 显卡自带了驱动，如果使用 <code>nvidia-smi</code> 命令可以查看显卡状态则说明自带驱动（上方会注明驱动版本、CUDA 版本，但此时<strong>可能</strong>用不了 <code>nvcc</code> 命令）。</p><p>初次登录可以先测试 <code>nvidia-smi</code>，否则就需要手动安装 N 卡驱动：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs Shell"><span class="hljs-meta">$</span><span class="bash"> sudo add-apt-repository ppa:graphics-drivers/ppa  <span class="hljs-comment"># 把显卡驱动加入PPA</span></span><br><span class="hljs-meta">$</span><span class="bash"> ubuntu-drivers devices  <span class="hljs-comment"># 查找当前设备适合的驱动版本</span></span><br><span class="hljs-meta">$</span><span class="bash"> sudo apt-get install nvidia-driver-418  <span class="hljs-comment"># 安装对应版本</span></span><br></code></pre></div></td></tr></table></figure></blockquote><h3 id="第三方库"><a href="#第三方库" class="headerlink" title="第三方库"></a>第三方库</h3><p>使用 <code>pip</code> 进行安装时，建议安装在<strong>虚拟环境</strong>中，特别是一些<strong>不常用</strong>的包。如果下载过慢或失败，可以使用清华源进行下载，使用以下命令在<strong>个人配置</strong>中更新及换源：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs Shell"><span class="hljs-meta">$</span><span class="bash"> pip install -U pip -i https://pypi.tuna.tsinghua.edu.cn/simple</span><br><span class="hljs-meta">$</span><span class="bash"> pip config <span class="hljs-built_in">set</span> global.index-url https://pypi.tuna.tsinghua.edu.cn/simple</span><br></code></pre></div></td></tr></table></figure><p>如果不方便换源，临时使用的方法为：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs Shell"><span class="hljs-meta">$</span><span class="bash"> pip install &lt;package&gt; -i https://pypi.tuna.tsinghua.edu.cn/simple</span><br></code></pre></div></td></tr></table></figure><p>这里以 PyTorch 为例，我们将其装在<strong>虚拟环境</strong>中，使用以下命令，不同库之间用<strong>空格隔开</strong>可一并安装：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs Shell"><span class="hljs-meta">$</span><span class="bash"> pip install torch torchvision torchaudio</span><br></code></pre></div></td></tr></table></figure><blockquote><p>为什么 PyTorch 不要装在基本环境？因为安装高版本的 PyTorch 时会自动替换 Numpy 等依赖库至相应版本。而这些自动替换的基础库很有可能与其他高级库产生不匹配的冲突，导致原先功能无法正常使用，也就是原先的运行环境会被污染。此外这样也便于虚拟环境的拷贝。</p></blockquote><p>成功安装后可以在命令行里打开 Python 测试：</p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">import</span> torch<br><span class="hljs-meta">&gt;&gt;&gt; </span>torch.__version__<br><span class="hljs-meta">&gt;&gt;&gt; </span>torch.cuda.is_available()<br><span class="hljs-meta">&gt;&gt;&gt; </span>torch.cuda.device_count()<br><span class="hljs-meta">&gt;&gt;&gt; </span>torch.tensor([<span class="hljs-number">1.0</span>, <span class="hljs-number">2.0</span>]).cuda()<br><span class="hljs-comment"># 1.9.1+cu11.1</span><br><span class="hljs-comment"># True</span><br><span class="hljs-comment"># 4</span><br><span class="hljs-comment"># tensor([1., 2.], device=&#x27;cuda:0&#x27;)</span><br></code></pre></div></td></tr></table></figure><p>下面列举需要安装在<strong>基本环境</strong>中的常用库，安装方法同上：</p><ul><li><code>gpustat</code>：用于查看动态查看 GPU 状态（需要 Nvidia 驱动），<code>watch -n1 -c gpustat --color</code>。</li><li><code>ipdb</code>：用于简易的断点调试，可以看做 <code>pdb</code> 的升级版，<code>python -m ipdb main.py</code>。</li></ul><h3 id="Notebook"><a href="#Notebook" class="headerlink" title="Notebook"></a>Notebook</h3><p>有时候需要在远程服务器中使用 Jupyter Notebook，就需要先在远程安装：</p><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">$ conda install -c conda-forge jupyter notebook<br></code></pre></div></td></tr></table></figure><p>之后就可以在远程启动 Jupyter 服务，内核放在远程：</p><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">$ jupyter notebook --port=8889<br></code></pre></div></td></tr></table></figure><p>启动后会获得服务的 URL 地址，这个地址可以在本地用浏览器直接打开，也可以在 VSCode 中安装 Jupyter 插件后打开。</p><h2 id="个人配置"><a href="#个人配置" class="headerlink" title="个人配置"></a>个人配置</h2><p>如果这个服务器需要<strong>长期使用</strong>，那么进行下面的配置就很有必要。以下大部分内容需要用 <code>apt</code> 包管理器安装，因此需要获取 <code>sudo</code> 临时<strong>管理员权限</strong>，如果没有可以向管理员申请。</p><h3 id="Git-配置"><a href="#Git-配置" class="headerlink" title="Git 配置"></a>Git 配置</h3><p>安装 Git 后，在 <code>~</code> 下就会存在一个 <code>.gitconfig</code> 或 <code>.config/git/config</code> 的文件，如果没有则需自行安装：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs Shell"><span class="hljs-meta">$</span><span class="bash"> sudo apt-get install git -y  <span class="hljs-comment"># -y 表示默认 yes</span></span><br></code></pre></div></td></tr></table></figure><p>在服务器里配置 Git 有三层，每层的配置（系统 <code>--system</code> 、全局 <code>--global</code>、仓库 <code>--local</code>）都会<strong>覆盖掉上一层次</strong>的配置，这里要修改 <code>~</code> 下的<strong>个人配置</strong>，则需要用到 <code>--global</code>：</p><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash"><span class="hljs-comment"># 替换成个人信息！</span><br>$ git config --global user.name <span class="hljs-string">&quot;hewei2001&quot;</span><br>$ git config --global user.email <span class="hljs-string">&quot;631670924@qq.com&quot;</span><br><span class="hljs-comment"># 常用的指令可以取 alias 别名</span><br>$ git config --global alias.showlog <span class="hljs-string">&quot;log --graph --pretty=format:&#x27;%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)&lt;%an&gt;%Creset&#x27; --abbrev-commit --date=relative&quot;</span><br></code></pre></div></td></tr></table></figure><p>如果需要建立远程 SSH 鉴权，使用以下命令打印出<strong>公钥</strong>，手动复制到 GitHub 上：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs Shell"><span class="hljs-meta">$</span><span class="bash"> ssh-keygen -t rsa -C <span class="hljs-string">&quot;631670924@qq.com&quot;</span>  <span class="hljs-comment"># 生成</span></span><br><span class="hljs-meta">$</span><span class="bash"> cat ~/.ssh/id_rsa.pub  <span class="hljs-comment"># 打印</span></span><br><span class="hljs-meta">$</span><span class="bash"> ssh -T git@github.com  <span class="hljs-comment"># 测试</span></span><br></code></pre></div></td></tr></table></figure><h3 id="oh-my-zsh"><a href="#oh-my-zsh" class="headerlink" title="oh-my-zsh"></a>oh-my-zsh</h3><p>首先检查<strong>服务器可用终端</strong>是否包含 <code>zsh</code>，如果有直接切换，并安装<strong>插件管理器</strong> <code>oh-my-zsh</code>：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs Shell"><span class="hljs-meta">$</span><span class="bash"> cat /etc/shells  <span class="hljs-comment"># 打印可用终端，看有没有 /bin/zsh</span></span> <br><span class="hljs-meta">$</span><span class="bash"> chsh -s /bin/zsh</span> <br><span class="hljs-meta">$</span><span class="bash"> git <span class="hljs-built_in">clone</span> git://github.com/robbyrussell/oh-my-zsh.git ~/.oh-my-zsh</span><br><span class="hljs-meta">$</span><span class="bash"> cp ~/.zshrc ~/.zshrc.bak  <span class="hljs-comment"># 备份原配置</span></span><br><span class="hljs-meta">$</span><span class="bash"> cp ~/.oh-my-zsh/templates/zshrc.zsh-template ~/.zshrc</span><br><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">source</span> ~/.zshrc</span><br></code></pre></div></td></tr></table></figure><p>如果没有自带 <code>zsh</code>，完成以下几步后，就可以成功安装二者：</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs Shell"><span class="hljs-meta">$</span><span class="bash"> sudo apt-get install zsh -y</span><br><span class="hljs-meta">$</span><span class="bash"> git <span class="hljs-built_in">clone</span> git://github.com/robbyrussell/oh-my-zsh.git ~/.oh-my-zsh</span><br><span class="hljs-meta">$</span><span class="bash"> cp ~/.zshrc ~/.zshrc.bak  <span class="hljs-comment"># 备份原配置</span></span><br><span class="hljs-meta">$</span><span class="bash"> cp ~/.oh-my-zsh/templates/zshrc.zsh-template ~/.zshrc</span><br><span class="hljs-meta">$</span><span class="bash"> chsh -s /bin/zsh  <span class="hljs-comment"># 切换终端</span></span><br></code></pre></div></td></tr></table></figure><blockquote><p>如果执行第一步时无 <code>sudo</code> 权限，则需要自行安装资源包及依赖，参考：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/XiiX/p/14618799.html">Linux 以非 root 用户安装 zsh</a>。</p></blockquote><p>重启系统，此时已经进入新的 <code>zsh</code> 终端，下载将要用到的主题和插件：</p><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash"><span class="hljs-comment"># 主题 powerlevel10k</span><br>$ git <span class="hljs-built_in">clone</span> --depth=1 https://gitee.com/romkatv/powerlevel10k.git <span class="hljs-variable">$&#123;ZSH_CUSTOM:-~/.oh-my-zsh/custom&#125;</span>/themes/powerlevel10k<br><span class="hljs-comment"># 两个插件</span><br>$ git <span class="hljs-built_in">clone</span> --depth=1 https://github.com/zsh-users/zsh-autosuggestions <span class="hljs-variable">$&#123;ZSH_CUSTOM:-~/.oh-my-zsh/custom&#125;</span>/plugins/zsh-autosuggestions<br>$ git <span class="hljs-built_in">clone</span> --depth=1 https://github.com/zsh-users/zsh-syntax-highlighting.git <span class="hljs-variable">$&#123;ZSH_CUSTOM:-~/.oh-my-zsh/custom&#125;</span>/plugins/zsh-syntax-highlighting<br></code></pre></div></td></tr></table></figure><p>打开 <code>.zshrc</code>，<strong>手动修改</strong>以下配置：</p><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash"><span class="hljs-comment"># 主题，如果要用自带的主题推荐 bira</span><br>ZSH_THEME=<span class="hljs-string">&quot;powerlevel10k/powerlevel10k&quot;</span><br><span class="hljs-comment"># 插件</span><br>plugins=(git <br>		 tmux <br>		 z <br>		 extract <br>		 zsh-autosuggestions<br>		 zsh-syntax-highlighting)<br></code></pre></div></td></tr></table></figure><p><code>oh-my-zsh</code> 自带的插件定义了常用的别名，可以用 <code>alias</code> 命令查看：</p><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash"><span class="hljs-comment"># git 相关</span><br>gaa = git add --all <br>gcmsg = git commit -m <br>ga = git add <br>gst = git status <br>gp = git push<br><span class="hljs-comment"># tmux 相关</span><br>tl = tmux list-sessions<br>tkss = tmux kill-session -t<br>ta = tmux attach -t<br>ts = tmux new-session -s<br></code></pre></div></td></tr></table></figure><p>下面是部分自带的插件、需要手动安装的插件介绍：</p><ul><li><code>z</code>：在常用目录之间<strong>直接跳转</strong>，使用 <code>z &lt;dir_name&gt;</code>。</li><li><code>extract</code>：<strong>一键解压</strong>各种形式压缩包，使用 <code>x &lt;file_name&gt;</code>。</li><li><code>gitignore</code>：一键生成 gitignore 模板，使用 <code>gi python &gt; .gitignore</code>。</li><li><code>cpv</code>：带进度条复制文件，使用 <code>cpv &lt;a&gt; &lt;b&gt;</code>。</li><li><code>colored-man-pages</code>：带颜色的 <code>man</code> 菜单。</li><li><p><code>sudo</code>：上一条命令忘记加 <code>sudo</code>，双击 <code>ESC</code> 就会自动加上。</p></li><li><p><code>zsh-autosuggestions</code>：<strong>命令补全</strong>插件，需要手动安装。</p></li><li><code>zsh-syntax-highlighting</code>：<strong>命令高亮</strong>插件，需要手动安装。</li></ul><blockquote><p>之前在 <code>.bashrc</code> 里的一些配置也要搬过来，主要有 <strong>Conda 环境的路径配置</strong>和一些 alias，配置完成后使用 <code>source ~/.zshrc</code> 命令<strong>重启终端</strong>即可。之后会进入主题的引导设置，如果想重新配置可以输入 <code>p10k configure</code> 命令。</p></blockquote><h3 id="反向代理"><a href="#反向代理" class="headerlink" title="反向代理"></a>反向代理</h3><p>加载预训练模型时，总是不可避免地要去访问国外下载源，而部署在国内网络的服务器则无能为力。此时就需要在主机使用 VPN，通过「<strong>反向代理</strong>」的方法让服务器也能使用到主机的 VPN。</p><p>在<strong>本机</strong>终端输入以下命令，并保持终端开启：</p><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">$ ssh -NR 12306:localhost:7890 hewei@10.249.xx.xxx<br><span class="hljs-comment"># 其中 12306 可以是任意端口，7890 则必须改成 VPN 的代理端口！</span><br></code></pre></div></td></tr></table></figure><p>在<strong>服务器</strong>终端输入以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">$ <span class="hljs-built_in">export</span> http_proxy=http://127.0.0.1:12306/<br>$ <span class="hljs-built_in">export</span> https_proxy=http://127.0.0.1:12306/<br><span class="hljs-comment"># 其中 12306 必须和 前述端口 一致！</span><br></code></pre></div></td></tr></table></figure><p>完成后，可以使用 <code>wget google.com</code> 测试是否成功。为了方便在服务器开启服务，可以在 <code>~./zshrc</code> 中加上别名:</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs Shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">alias</span> proxyon=<span class="hljs-string">&#x27;export http_proxy=http://127.0.0.1:12306 https_proxy=http://127.0.0.1:12306 &amp;&amp; echo Proxy On!&#x27;</span></span><br><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">alias</span> proxyoff=<span class="hljs-string">&#x27;unset http_proxy https_proxy &amp;&amp; echo Proxy Off!&#x27;</span></span><br></code></pre></div></td></tr></table></figure><blockquote><p>如果上述方法行不通，除了用本机下载预训练模型后 <code>scp</code> 到服务器，还可尝试此方案：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/475260268">如何优雅的下载 huggingface-transformers 模型</a>。</p></blockquote><h2 id="一键配置"><a href="#一键配置" class="headerlink" title="一键配置"></a>一键配置</h2><p>下面对于<strong>临时使用的命令</strong>进行汇总，由 Shell 脚本的形式一键执行。只需在 <code>/home/user</code> 目录下新建一个 <code>hello.sh</code> 文件，输入以下内容：</p><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br><br>wget https://mirrors.tuna.tsinghua.edu.cn/anaconda/archive/Anaconda3-2020.02-Linux-x86_64.sh<br>bash Anaconda3-2020.02-Linux-x86_64.sh<br><span class="hljs-built_in">source</span> .bashrc<br><br>conda install -c conda-forge cudatoolkit=11.1 cudnn<br><br>pip install -U pip -i https://pypi.tuna.tsinghua.edu.cn/simple<br>pip config <span class="hljs-built_in">set</span> global.index-url https://pypi.tuna.tsinghua.edu.cn/simple<br>pip install gpustat<br>pip install ipdb<br><br><span class="hljs-comment"># 别名配置</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;alias gpus=&#x27;watch -n1 -c gpustat --color&#x27;&quot;</span> &gt;&gt; ~/.bashrc<br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;alias ca=&#x27;conda activate&#x27;&quot;</span> &gt;&gt; ~/.bashrc<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;alias cda=&#x27;conda deactivate&#x27;&quot;</span> &gt;&gt; ~/.bashrc<br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;alias proxyon=&#x27;export http_proxy=http://127.0.0.1:12306 https_proxy=http://127.0.0.1:12306 &amp;&amp; echo Proxy On!&#x27;&quot;</span> &gt;&gt; ~/.bashrc<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;alias proxyoff=&#x27;unset http_proxy https_proxy &amp;&amp; echo Proxy Off!&#x27;&quot;</span> &gt;&gt; ~/.bashrc<br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;alias tl=&#x27;tmux list-sessions&#x27;&quot;</span> &gt;&gt; ~/.bashrc<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;alias tkss=&#x27;tmux kill-session -t&#x27;&quot;</span> &gt;&gt; ~/.bashrc<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;alias ta=&#x27;tmux attach -t&#x27;&quot;</span> &gt;&gt; ~/.bashrc<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;alias ts=&#x27;tmux new-session -s&#x27;&quot;</span> &gt;&gt; ~/.bashrc<br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;alias ll=&#x27;ls -alF&#x27;&quot;</span> &gt;&gt; ~/.bashrc<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;alias la=&#x27;ls -A&#x27;&quot;</span> &gt;&gt; ~/.bashrc<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;alias l=&#x27;ls -CF&#x27;&quot;</span> &gt;&gt; ~/.bashrc<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;alias ls=&#x27;ls --color=tty&#x27;&quot;</span> &gt;&gt; ~/.bashrc<br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;alias cd..=&#x27;cd ..&#x27;&quot;</span> &gt;&gt; ~/.bashrc<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;alias md=&#x27;mkdir -p&#x27;&quot;</span> &gt;&gt; ~/.bashrc<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;alias rd=rmdir&quot;</span> &gt;&gt; ~/.bashrc<br><br><span class="hljs-built_in">source</span> .bashrc<br><br><span class="hljs-comment"># git 配置，替换成自己的</span><br>git config --global user.name <span class="hljs-string">&quot;hewei2001&quot;</span><br>git config --global user.email <span class="hljs-string">&quot;631670924@qq.com&quot;</span><br></code></pre></div></td></tr></table></figure><p>在命令行中执行 <code>bash hello.sh</code>。</p></div><hr><div><div class="post-metas mb-3"><div class="post-meta mr-3"><i class="iconfont icon-category"></i> <a class="hover-with-bg" href="/categories/%E6%8A%80%E6%9C%AF%E7%BB%8F%E9%AA%8C/">技术经验</a> <a class="hover-with-bg" href="/categories/%E6%8A%80%E6%9C%AF%E7%BB%8F%E9%AA%8C/Linux/">Linux</a></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a class="hover-with-bg" href="/tags/Linux/">Linux</a></div></div><p class="note note-warning">本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="nofollow noopener noopener"><u>CC BY-NC-SA 4.0</u></a> 协议，转载请注明来自 <a href="https://hwcoder.top" rel="noopener"><u>Hwcoder</u></a>！</p><div class="post-prevnext"><article class="post-prev col-6"><a href="/Awesome-Sites"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">科研常用网站合集</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/ML-Note-7"><span class="hidden-mobile">ML学习笔记 #7 神经网络：反向传播</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article class="comments" id="comments" lazyload><div id="valine"></div><script type="text/javascript">Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://cdn.jsdelivr.net/npm/valine@1/dist/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"jdbBr3BddTiqSCPnXw6sXFv7-gzGzoHsz","appKey":"2bjgwDr2opjVCwhgjDMpk53c","path":"window.location.pathname","placeholder":"说点什么吧( •̀ ω •́ )✧","avatar":"retro","meta":["nick","mail","link"],"requiredFields":["nick"],"pageSize":10,"lang":"zh-CN","highlight":true,"recordIP":true,"serverURLs":"","emojiCDN":null,"emojiMaps":null,"enableQQ":false},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          Fluid.plugins.initFancyBox('#valine .vcontent img:not(.vemoji)');
        })
      });
    });</script><noscript>Please enable JavaScript to view the comments</noscript></article></article></div></div></div><div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p><div class="toc-body" id="toc-body"></div></div></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer class="text-center mt-5 py-3"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a></div><div class="statistics"><span id="leancloud-site-pv-container" style="display:none">总访问量 <span id="leancloud-site-pv"></span> 次 </span><span id="leancloud-site-uv-container" style="display:none">总访客数 <span id="leancloud-site-uv"></span> 人</span></div></footer><script src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",function(){NProgress.done()})</script><script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="/js/local-search.js"></script><script src="/js/img-lazyload.js"></script><script src="https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/anchor-js@4/anchor.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script><script defer src="/js/leancloud.js"></script><script src="https://cdn.jsdelivr.net/npm/typed.js@2/lib/typed.min.js"></script><script>!function(t){(0,Fluid.plugins.typing)(t.getElementById("subtitle").title)}((window,document))</script><script src="/js/boot.js"></script></body></html>